var je=Object.defineProperty;var Ye=(s,n,t)=>n in s?je(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var l=(s,n,t)=>Ye(s,typeof n!="symbol"?n+"":n,t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let qt;try{qt={window,document}}catch{/* istanbul ignore next -- @preserve */qt={window:{},document:{}}}const j=qt;/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function se(){return function s(){s.called=!0}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class nt{constructor(n,t){l(this,"source");l(this,"name");l(this,"path");l(this,"stop");l(this,"off");l(this,"return");this.source=n,this.name=t,this.path=[],this.stop=se(),this.off=se()}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const T=new Array(256).fill("").map((s,n)=>("0"+n.toString(16)).slice(-2));function Ot(){const[s,n,t,e]=crypto.getRandomValues(new Uint32Array(4));return"e"+T[s>>0&255]+T[s>>8&255]+T[s>>16&255]+T[s>>24&255]+T[n>>0&255]+T[n>>8&255]+T[n>>16&255]+T[n>>24&255]+T[t>>0&255]+T[t>>8&255]+T[t>>16&255]+T[t>>24&255]+T[e>>0&255]+T[e>>8&255]+T[e>>16&255]+T[e>>24&255]}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Jt={get(s="normal"){return typeof s!="number"?this[s]||this.normal:s},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Xe(s,n){const t=Jt.get(n.priority);let e=0,i=s.length;for(;e<i;){const r=e+i>>1;Jt.get(s[r].priority)<t?i=r:e=r+1}s.splice(e,0,n)}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const He="https://ckeditor.com/docs/ckeditor5/latest/support/error-codes.html";class u extends Error{constructor(t,e,i){super(Ze(t,i));l(this,"context");l(this,"data");this.name="CKEditorError",this.context=e,this.data=i}is(t){return t==="CKEditorError"}static rethrowUnexpectedError(t,e){if(t.is&&t.is("CKEditorError"))throw t;const i=new u(t.message,e);throw i.stack=t.stack,i}}function $t(s,n){console.warn(...Qe(s,n))}function Ae(s){return`
Read more: ${He}#error-${s}`}function Ze(s,n){const t=new WeakSet,i=n?` ${JSON.stringify(n,(o,a)=>{if(typeof a=="object"&&a!==null){if(t.has(a))return`[object ${a.constructor.name}]`;t.add(a)}return a})}`:"",r=Ae(s);return s+i+r}function Qe(s,n){const t=Ae(s);return n?[s,n,t]:[s,t]}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const ts="45.1.0";/* istanbul ignore next -- @preserve */if(globalThis.CKEDITOR_VERSION)throw new u("ckeditor-duplicated-modules",null);globalThis.CKEDITOR_VERSION=ts;/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const tt=Symbol("listeningTo"),Wt=Symbol("emitterId"),I=Symbol("delegations"),Se=E(Object);function E(s){if(!s)return Se;class n extends s{on(e,i,r){this.listenTo(this,e,i,r)}once(e,i,r){let o=!1;const a=(f,...h)=>{o||(o=!0,f.off(),i.call(this,f,...h))};this.listenTo(this,e,a,r)}off(e,i){this.stopListening(this,e,i)}listenTo(e,i,r,o={}){let a,f;this[tt]||(this[tt]={});const h=this[tt];Nt(e)||Ee(e);const d=Nt(e);(a=h[d])||(a=h[d]={emitter:e,callbacks:{}}),(f=a.callbacks[i])||(f=a.callbacks[i]=[]),f.push(r),rs(this,e,i,r,o)}stopListening(e,i,r){const o=this[tt];let a=e&&Nt(e);const f=o&&a?o[a]:void 0,h=f&&i?f.callbacks[i]:void 0;if(!(!o||e&&!f||i&&!h))if(r)kt(this,e,i,r),h.indexOf(r)!==-1&&(h.length===1?delete f.callbacks[i]:kt(this,e,i,r));else if(h){for(;r=h.pop();)kt(this,e,i,r);delete f.callbacks[i]}else if(f){for(i in f.callbacks)this.stopListening(e,i);delete o[a]}else{for(a in o)this.stopListening(o[a].emitter);delete this[tt]}}fire(e,...i){try{const r=e instanceof nt?e:new nt(this,e),o=r.name;let a=is(this,o);if(r.path.push(this),a){a=a.slice();for(let h=0;h<a.length;h++){const d=a[h].callback;if(d.call(this,r,...i),r.off.called&&(delete r.off.called,this._removeEventListener(o,d)),r.stop.called)break}}const f=this[I];if(f){const h=f.get(o),d=f.get("*");h&&ne(h,r,i),d&&ne(d,r,i)}return r.return}catch(r){/* istanbul ignore next -- @preserve */u.rethrowUnexpectedError(r,this)}}delegate(...e){return{to:(i,r)=>{this[I]||(this[I]=new Map),e.forEach(o=>{const a=this[I].get(o);a?a.set(i,r):this[I].set(o,new Map([[i,r]]))})}}}stopDelegating(e,i){if(this[I])if(!e)this[I].clear();else if(!i)this[I].delete(e);else{const r=this[I].get(e);r&&r.delete(i)}}_addEventListener(e,i,r){ns(this,e);const o=zt(this,e),a=Jt.get(r.priority),f={callback:i,priority:a};for(const h of o)Xe(h,f)}_removeEventListener(e,i){const r=zt(this,e);for(const o of r)for(let a=0;a<o.length;a++)o[a].callback==i&&(o.splice(a,1),a--)}}return n}["on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(s=>{E[s]=Se.prototype[s]});function es(s,n){const t=s[tt];return t&&t[n]?t[n].emitter:null}function Ee(s,n){s[Wt]||(s[Wt]=n||Ot())}function Nt(s){return s[Wt]}function xe(s){return s._events||Object.defineProperty(s,"_events",{value:{}}),s._events}function ss(){return{callbacks:[],childEvents:[]}}function ns(s,n){const t=xe(s);if(t[n])return;let e=n,i=null;const r=[];for(;e!==""&&!t[e];)t[e]=ss(),r.push(t[e]),i&&t[e].childEvents.push(i),i=e,e=e.substr(0,e.lastIndexOf(":"));if(e!==""){for(const o of r)o.callbacks=t[e].callbacks.slice();t[e].childEvents.push(i)}}function zt(s,n){const t=xe(s)[n];if(!t)return[];let e=[t.callbacks];for(let i=0;i<t.childEvents.length;i++){const r=zt(s,t.childEvents[i]);e=e.concat(r)}return e}function is(s,n){if(!s._events)return null;let t=n;do{const e=s._events[t];if(e&&e.callbacks&&e.callbacks.length)return e.callbacks;const i=t.lastIndexOf(":");t=i>-1?t.substring(0,i):""}while(t);return null}function ne(s,n,t){for(let[e,i]of s){i?typeof i=="function"&&(i=i(n.name)):i=n.name;const r=new nt(n.source,i);r.path=[...n.path],e.fire(r,...t)}}function rs(s,n,t,e,i){n._addEventListener?n._addEventListener(t,e,i):s._addEventListener.call(n,t,e,i)}function kt(s,n,t,e){n._removeEventListener?n._removeEventListener(t,e):s._removeEventListener.call(n,t,e)}function os(){}function as(s){return s==null||typeof s!="object"&&typeof s!="function"}function ls(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function hs(s){if(as(s))return s;if(Array.isArray(s)||ls(s)||s instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&s instanceof SharedArrayBuffer)return s.slice(0);const n=Object.getPrototypeOf(s),t=n.constructor;if(s instanceof Date||s instanceof Map||s instanceof Set)return new t(s);if(s instanceof RegExp){const e=new t(s);return e.lastIndex=s.lastIndex,e}if(s instanceof DataView)return new t(s.buffer.slice(0));if(s instanceof Error){const e=new t(s.message);return e.stack=s.stack,e.name=s.name,e.cause=s.cause,e}if(typeof File<"u"&&s instanceof File)return new t([s],s.name,{type:s.type,lastModified:s.lastModified});if(typeof s=="object"){const e=Object.create(n);return Object.assign(e,s)}return s}function ie(s){if(!s||typeof s!="object")return!1;const n=Object.getPrototypeOf(s);return n===null||n===Object.prototype||Object.getPrototypeOf(n)===null?Object.prototype.toString.call(s)==="[object Object]":!1}function re(s){return Object.getOwnPropertySymbols(s).filter(n=>Object.prototype.propertyIsEnumerable.call(s,n))}function oe(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(s)}const fs="[object RegExp]",us="[object String]",cs="[object Number]",ds="[object Boolean]",ae="[object Arguments]",gs="[object Symbol]",ms="[object Date]",ps="[object Map]",_s="[object Set]",ys="[object Array]",ws="[object Function]",Ps="[object ArrayBuffer]",Mt="[object Object]",vs="[object Error]",bs="[object DataView]",As="[object Uint8Array]",Ss="[object Uint8ClampedArray]",Es="[object Uint16Array]",xs="[object Uint32Array]",Os="[object BigUint64Array]",Ts="[object Int8Array]",Rs="[object Int16Array]",Ns="[object Int32Array]",ks="[object BigInt64Array]",Ms="[object Float32Array]",Bs="[object Float64Array]";function Cs(s,n){return s===n||Number.isNaN(s)&&Number.isNaN(n)}function Fs(s,n,t){return ft(s,n,void 0,void 0,void 0,void 0,t)}function ft(s,n,t,e,i,r,o){const a=o(s,n,t,e,i,r);if(a!==void 0)return a;if(typeof s==typeof n)switch(typeof s){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return s===n;case"number":return s===n||Object.is(s,n);case"function":return s===n;case"object":return ct(s,n,r,o)}return ct(s,n,r,o)}function ct(s,n,t,e){if(Object.is(s,n))return!0;let i=oe(s),r=oe(n);if(i===ae&&(i=Mt),r===ae&&(r=Mt),i!==r)return!1;switch(i){case us:return s.toString()===n.toString();case cs:{const f=s.valueOf(),h=n.valueOf();return Cs(f,h)}case ds:case ms:case gs:return Object.is(s.valueOf(),n.valueOf());case fs:return s.source===n.source&&s.flags===n.flags;case ws:return s===n}t=t??new Map;const o=t.get(s),a=t.get(n);if(o!=null&&a!=null)return o===n;t.set(s,n),t.set(n,s);try{switch(i){case ps:{if(s.size!==n.size)return!1;for(const[f,h]of s.entries())if(!n.has(f)||!ft(h,n.get(f),f,s,n,t,e))return!1;return!0}case _s:{if(s.size!==n.size)return!1;const f=Array.from(s.values()),h=Array.from(n.values());for(let d=0;d<f.length;d++){const m=f[d],p=h.findIndex(y=>ft(m,y,void 0,s,n,t,e));if(p===-1)return!1;h.splice(p,1)}return!0}case ys:case As:case Ss:case Es:case xs:case Os:case Ts:case Rs:case Ns:case ks:case Ms:case Bs:{if(typeof Buffer<"u"&&Buffer.isBuffer(s)!==Buffer.isBuffer(n)||s.length!==n.length)return!1;for(let f=0;f<s.length;f++)if(!ft(s[f],n[f],f,s,n,t,e))return!1;return!0}case Ps:return s.byteLength!==n.byteLength?!1:ct(new Uint8Array(s),new Uint8Array(n),t,e);case bs:return s.byteLength!==n.byteLength||s.byteOffset!==n.byteOffset?!1:ct(new Uint8Array(s),new Uint8Array(n),t,e);case vs:return s.name===n.name&&s.message===n.message;case Mt:{if(!(ct(s.constructor,n.constructor,t,e)||ie(s)&&ie(n)))return!1;const h=[...Object.keys(s),...re(s)],d=[...Object.keys(n),...re(n)];if(h.length!==d.length)return!1;for(let m=0;m<h.length;m++){const p=h[m],y=s[p];if(!Object.hasOwn(n,p))return!1;const A=n[p];if(!ft(y,A,p,s,n,t,e))return!1}return!0}default:return!1}}finally{t.delete(s),t.delete(n)}}function le(s,n){return Fs(s,n,os)}function Oe(s){switch(typeof s){case"number":case"symbol":return!1;case"string":return s.includes(".")||s.includes("[")||s.includes("]")}}function Te(s){return Object.is(s,-0)?"-0":s.toString()}function Re(s){const n=[],t=s.length;if(t===0)return n;let e=0,i="",r="",o=!1;for(s.charCodeAt(0)===46&&(n.push(""),e++);e<t;){const a=s[e];r?a==="\\"&&e+1<t?(e++,i+=s[e]):a===r?r="":i+=a:o?a==='"'||a==="'"?r=a:a==="]"?(o=!1,n.push(i),i=""):i+=a:a==="["?(o=!0,i&&(n.push(i),i="")):a==="."?i&&(n.push(i),i=""):i+=a,e++}return i&&n.push(i),n}function jt(s,n,t){if(s==null)return t;switch(typeof n){case"string":{const e=s[n];return e===void 0?Oe(n)?jt(s,Re(n),t):t:e}case"number":case"symbol":{typeof n=="number"&&(n=Te(n));const e=s[n];return e===void 0?t:e}default:{if(Array.isArray(n))return Is(s,n,t);Object.is(n==null?void 0:n.valueOf(),-0)?n="-0":n=String(n);const e=s[n];return e===void 0?t:e}}}function Is(s,n,t){if(n.length===0)return t;let e=s;for(let i=0;i<n.length;i++){if(e==null)return t;e=e[n[i]]}return e===void 0?t:e}function Ut(s){return s!==null&&(typeof s=="object"||typeof s=="function")}function Ls(s,n){if(s==null)return!0;switch(typeof n){case"symbol":case"number":case"object":{if(Array.isArray(n))return he(s,n);if(typeof n=="number"?n=Te(n):typeof n=="object"&&(Object.is(n==null?void 0:n.valueOf(),-0)?n="-0":n=String(n)),(s==null?void 0:s[n])===void 0)return!0;try{return delete s[n],!0}catch{return!1}}case"string":{if((s==null?void 0:s[n])===void 0&&Oe(n))return he(s,Re(n));try{return delete s[n],!0}catch{return!1}}}}function he(s,n){const t=jt(s,n.slice(0,-1),s),e=n[n.length-1];if((t==null?void 0:t[e])===void 0)return!0;try{return delete t[e],!0}catch{return!1}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const dt=Symbol("observableProperties"),_t=Symbol("boundObservables"),gt=Symbol("boundProperties"),U=Symbol("decoratedMethods"),fe=Symbol("decoratedOriginal"),Ne=Yt(E());function Yt(s){var t,e,i,r,o;if(!s)return Ne;class n extends(o=s,r=dt,i=U,e=gt,t=_t,o){constructor(){super(...arguments);l(this,r);l(this,i);l(this,e);l(this,t)}set(h,d){if(Ut(h)){Object.keys(h).forEach(p=>{this.set(p,h[p])},this);return}Bt(this);const m=this[dt];if(h in this&&!m.has(h))throw new u("observable-set-cannot-override",this);Object.defineProperty(this,h,{enumerable:!0,configurable:!0,get(){return m.get(h)},set(p){const y=m.get(h);let A=this.fire(`set:${h}`,h,p,y);A===void 0&&(A=p),(y!==A||!m.has(h))&&(m.set(h,A),this.fire(`change:${h}`,h,A,y))}}),this[h]=d}bind(...h){if(!h.length||!ue(h))throw new u("observable-bind-wrong-properties",this);if(new Set(h).size!==h.length)throw new u("observable-bind-duplicate-properties",this);Bt(this);const d=this[gt];h.forEach(p=>{if(d.has(p))throw new u("observable-bind-rebind",this)});const m=new Map;return h.forEach(p=>{const y={property:p,to:[]};d.set(p,y),m.set(p,y)}),{to:Vs,toMany:Ds,_observable:this,_bindProperties:h,_to:[],_bindings:m}}unbind(...h){if(!this[dt])return;const d=this[gt],m=this[_t];if(h.length){if(!ue(h))throw new u("observable-unbind-wrong-properties",this);h.forEach(p=>{const y=d.get(p);y&&(y.to.forEach(([A,At])=>{const ot=m.get(A),ee=ot[At];ee.delete(y),ee.size||delete ot[At],Object.keys(ot).length||(m.delete(A),this.stopListening(A,"change"))}),d.delete(p))})}else m.forEach((p,y)=>{this.stopListening(y,"change")}),m.clear(),d.clear()}decorate(h){Bt(this);const d=this[h];if(!d)throw new u("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:h});this.on(h,(m,p)=>{m.return=d.apply(this,p)}),this[h]=function(...m){return this.fire(h,m)},this[h][fe]=d,this[U]||(this[U]=[]),this[U].push(h)}stopListening(h,d,m){if(!h&&this[U]){for(const p of this[U])this[p]=this[p][fe];delete this[U]}super.stopListening(h,d,m)}}return n}["set","bind","unbind","decorate","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(s=>{Yt[s]=Ne.prototype[s]});function Bt(s){s[dt]||(Object.defineProperty(s,dt,{value:new Map}),Object.defineProperty(s,_t,{value:new Map}),Object.defineProperty(s,gt,{value:new Map}))}function Vs(...s){const n=Js(...s),t=Array.from(this._bindings.keys()),e=t.length;if(!n.callback&&n.to.length>1)throw new u("observable-bind-to-no-callback",this);if(e>1&&n.callback)throw new u("observable-bind-to-extra-callback",this);n.to.forEach(i=>{if(i.properties.length&&i.properties.length!==e)throw new u("observable-bind-to-properties-length",this);i.properties.length||(i.properties=this._bindProperties)}),this._to=n.to,n.callback&&(this._bindings.get(t[0]).callback=n.callback),zs(this._observable,this._to),Ws(this),this._bindProperties.forEach(i=>{ke(this._observable,i)})}function Ds(s,n,t){if(this._bindings.size>1)throw new u("observable-bind-to-many-not-one-binding",this);this.to(...qs(s,n),t)}function qs(s,n){const t=s.map(e=>[e,n]);return Array.prototype.concat.apply([],t)}function ue(s){return s.every(n=>typeof n=="string")}function Js(...s){if(!s.length)throw new u("observable-bind-to-parse-error",null);const n={to:[]};let t;return typeof s[s.length-1]=="function"&&(n.callback=s.pop()),s.forEach(e=>{if(typeof e=="string")t.properties.push(e);else if(typeof e=="object")t={observable:e,properties:[]},n.to.push(t);else throw new u("observable-bind-to-parse-error",null)}),n}function $s(s,n,t,e){const i=s[_t],r=i.get(t),o=r||{};o[e]||(o[e]=new Set),o[e].add(n),r||i.set(t,o)}function Ws(s){let n;s._bindings.forEach((t,e)=>{s._to.forEach(i=>{n=i.properties[t.callback?0:s._bindProperties.indexOf(e)],t.to.push([i.observable,n]),$s(s._observable,t,i.observable,n)})})}function ke(s,n){const e=s[gt].get(n);let i;e.callback?i=e.callback.apply(s,e.to.map(r=>r[0][r[1]])):(i=e.to[0],i=i[0][i[1]]),Object.prototype.hasOwnProperty.call(s,n)?s[n]=i:s.set(n,i)}function zs(s,n){n.forEach(t=>{const e=s[_t];let i;e.get(t.observable)||s.listenTo(t.observable,"change",(r,o)=>{i=e.get(t.observable)[o],i&&i.forEach(a=>{ke(s,a.property)})})})}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ce(s){let n=0;for(const t of s)n++;return n}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function N(s,n){const t=Math.min(s.length,n.length);for(let e=0;e<t;e++)if(s[e]!=n[e])return e;return s.length==n.length?"same":s.length<n.length?"prefix":"extension"}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function q(s){return!!(s&&s[Symbol.iterator])}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function de(s){if(s){if(s.defaultView)return s instanceof s.defaultView.Document;if(s.ownerDocument&&s.ownerDocument.defaultView)return s instanceof s.ownerDocument.defaultView.Node}return!1}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function ge(s){const n=Object.prototype.toString.apply(s);return n=="[object Window]"||n=="[object global]"}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Me=Be(E());function Be(s){if(!s)return Me;class n extends s{listenTo(e,i,r,o={}){if(de(e)||ge(e)||e instanceof j.window.EventTarget){const a={capture:!!o.useCapture,passive:!!o.usePassive},f=this._getProxyEmitter(e,a)||new Us(e,a);this.listenTo(f,i,r,o)}else super.listenTo(e,i,r,o)}stopListening(e,i,r){if(de(e)||ge(e)||e instanceof j.window.EventTarget){const o=this._getAllProxyEmitters(e);for(const a of o)this.stopListening(a,i,r)}else super.stopListening(e,i,r)}_getProxyEmitter(e,i){return es(this,Ce(e,i))}_getAllProxyEmitters(e){return[{capture:!1,passive:!1},{capture:!1,passive:!0},{capture:!0,passive:!1},{capture:!0,passive:!0}].map(i=>this._getProxyEmitter(e,i)).filter(i=>!!i)}}return n}["_getProxyEmitter","_getAllProxyEmitters","on","once","off","listenTo","stopListening","fire","delegate","stopDelegating","_addEventListener","_removeEventListener"].forEach(s=>{Be[s]=Me.prototype[s]});class Us extends E(){constructor(t,e){super();l(this,"_domNode");l(this,"_options");l(this,"_domListeners");Ee(this,Ce(t,e)),this._domNode=t,this._options=e}attach(t){if(this._domListeners&&this._domListeners[t])return;const e=this._createDomListener(t);this._domNode.addEventListener(t,e,this._options),this._domListeners||(this._domListeners={}),this._domListeners[t]=e}detach(t){let e;this._domListeners[t]&&(!(e=this._events[t])||!e.callbacks.length)&&this._domListeners[t].removeListener()}_addEventListener(t,e,i){this.attach(t),E().prototype._addEventListener.call(this,t,e,i)}_removeEventListener(t,e){E().prototype._removeEventListener.call(this,t,e),this.detach(t)}_createDomListener(t){const e=i=>{this.fire(t,i)};return e.removeListener=()=>{this._domNode.removeEventListener(t,e,this._options),delete this._domListeners[t]},e}}function Ks(s){return s["data-ck-expando"]||(s["data-ck-expando"]=Ot())}function Ce(s,n){let t=Ks(s);for(const e of Object.keys(n).sort())n[e]&&(t+="-"+e);return t}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Et(s){return Array.isArray(s)?s:[s]}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 *//* istanbul ignore else -- @preserve */j.window.CKEDITOR_TRANSLATIONS||(j.window.CKEDITOR_TRANSLATIONS={});/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Gs extends E(){constructor(t={},e={}){super();l(this,"_items");l(this,"_itemMap");l(this,"_idProperty");l(this,"_bindToCollection");l(this,"_bindToExternalToInternalMap");l(this,"_bindToInternalToExternalMap");l(this,"_skippedIndexesFromExternal");const i=q(t);if(i||(e=t),this._items=[],this._itemMap=new Map,this._idProperty=e.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],i)for(const r of t)this._items.push(r),this._itemMap.set(this._getItemIdBeforeAdding(r),r)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(t,e){return this.addMany([t],e)}addMany(t,e){if(e===void 0)e=this._items.length;else if(e>this._items.length||e<0)throw new u("collection-add-item-invalid-index",this);let i=0;for(const r of t){const o=this._getItemIdBeforeAdding(r),a=e+i;this._items.splice(a,0,r),this._itemMap.set(o,r),this.fire("add",r,a),i++}return this.fire("change",{added:t,removed:[],index:e}),this}get(t){let e;if(typeof t=="string")e=this._itemMap.get(t);else if(typeof t=="number")e=this._items[t];else throw new u("collection-get-invalid-arg",this);return e||null}has(t){if(typeof t=="string")return this._itemMap.has(t);{const e=this._idProperty,i=t[e];return i&&this._itemMap.has(i)}}getIndex(t){let e;return typeof t=="string"?e=this._itemMap.get(t):e=t,e?this._items.indexOf(e):-1}remove(t){const[e,i]=this._remove(t);return this.fire("change",{added:[],removed:[e],index:i}),e}map(t,e){return this._items.map(t,e)}forEach(t,e){this._items.forEach(t,e)}find(t,e){return this._items.find(t,e)}filter(t,e){return this._items.filter(t,e)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const t=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:t,index:0})}bindTo(t){if(this._bindToCollection)throw new u("collection-bind-to-rebind",this);return this._bindToCollection=t,{as:e=>{this._setUpBindToBinding(i=>new e(i))},using:e=>{typeof e=="function"?this._setUpBindToBinding(e):this._setUpBindToBinding(i=>i[e])}}}_setUpBindToBinding(t){const e=this._bindToCollection,i=(r,o,a)=>{const f=e._bindToCollection==this,h=e._bindToInternalToExternalMap.get(o);if(f&&h)this._bindToExternalToInternalMap.set(o,h),this._bindToInternalToExternalMap.set(h,o);else{const d=t(o);if(!d){this._skippedIndexesFromExternal.push(a);return}let m=a;for(const p of this._skippedIndexesFromExternal)a>p&&m--;for(const p of e._skippedIndexesFromExternal)m>=p&&m++;this._bindToExternalToInternalMap.set(o,d),this._bindToInternalToExternalMap.set(d,o),this.add(d,m);for(let p=0;p<e._skippedIndexesFromExternal.length;p++)m<=e._skippedIndexesFromExternal[p]&&e._skippedIndexesFromExternal[p]++}};for(const r of e)i(null,r,e.getIndex(r));this.listenTo(e,"add",i),this.listenTo(e,"remove",(r,o,a)=>{const f=this._bindToExternalToInternalMap.get(o);f&&this.remove(f),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((h,d)=>(a<d&&h.push(d-1),a>d&&h.push(d),h),[])})}_getItemIdBeforeAdding(t){const e=this._idProperty;let i;if(e in t){if(i=t[e],typeof i!="string")throw new u("collection-add-invalid-id",this);if(this.get(i))throw new u("collection-add-item-already-exists",this)}else t[e]=i=Ot();return i}_remove(t){let e,i,r,o=!1;const a=this._idProperty;if(typeof t=="string"?(i=t,r=this._itemMap.get(i),o=!r,r&&(e=this._items.indexOf(r))):typeof t=="number"?(e=t,r=this._items[e],o=!r,r&&(i=r[a])):(r=t,i=r[a],e=this._items.indexOf(r),o=e==-1||!this._itemMap.get(i)),o)throw new u("collection-remove-404",this);this._items.splice(e,1),this._itemMap.delete(i);const f=this._bindToInternalToExternalMap.get(r);return this._bindToInternalToExternalMap.delete(r),this._bindToExternalToInternalMap.delete(f),this.fire("remove",r,e),[r,e]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function js(s){const n=new Map;for(const t in s)n.set(t,s[t]);return n}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function yt(s){return q(s)?new Map(s):js(s)}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function me(s,n,t){const e=s.length,i=n.length;for(let r=e-1;r>=t;r--)s[r+i]=s[r];for(let r=0;r<i;r++)s[t+r]=n[r]}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let X=class{is(){throw new Error("is() method is abstract")}};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let H=class extends E(X){constructor(t){super();l(this,"document");l(this,"parent");this.document=t,this.parent=null}get index(){let t;if(!this.parent)return null;if((t=this.parent.getChildIndex(this))==-1)throw new u("view-node-not-found-in-parent",this);return t}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.root.is("rootElement")}getPath(){const t=[];let e=this;for(;e.parent;)t.unshift(e.index),e=e.parent;return t}getAncestors(t={}){const e=[];let i=t.includeSelf?this:this.parent;for(;i;)e[t.parentFirst?"push":"unshift"](i),i=i.parent;return e}getCommonAncestor(t,e={}){const i=this.getAncestors(e),r=t.getAncestors(e);let o=0;for(;i[o]==r[o]&&i[o];)o++;return o===0?null:i[o-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const e=this.getPath(),i=t.getPath(),r=N(e,i);switch(r){case"prefix":return!0;case"extension":return!1;default:return e[r]<i[r]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}_remove(){this.parent._removeChildren(this.index)}_fireChange(t,e,i){this.fire(`change:${t}`,e,i),this.parent&&this.parent._fireChange(t,e,i)}toJSON(){const t=hs(this);return delete t.parent,t}};H.prototype.is=function(s){return s==="node"||s==="view:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let G=class Kt extends H{constructor(t,e){super(t);l(this,"_textData");this._textData=e}get data(){return this._textData}get _data(){return this.data}set _data(t){this._fireChange("text",this),this._textData=t}isSimilar(t){return t instanceof Kt?this===t||this.data===t.data:!1}_clone(){return new Kt(this.document,this.data)}};G.prototype.is=function(s){return s==="$text"||s==="view:$text"||s==="text"||s==="view:text"||s==="node"||s==="view:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let V=class extends X{constructor(t,e,i){super();l(this,"textNode");l(this,"data");l(this,"offsetInText");if(this.textNode=t,e<0||e>t.data.length)throw new u("view-textproxy-wrong-offsetintext",this);if(i<0||e+i>t.data.length)throw new u("view-textproxy-wrong-length",this);this.data=t.data.substring(e,e+i),this.offsetInText=e}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}getAncestors(t={}){const e=[];let i=t.includeSelf?this.textNode:this.parent;for(;i!==null;)e[t.parentFirst?"push":"unshift"](i),i=i.parent;return e}};V.prototype.is=function(s){return s==="$textProxy"||s==="view:$textProxy"||s==="textProxy"||s==="view:textProxy"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Ys(s){const n=[];return"attributes"in s&&s.attributes&&Ct(n,s.attributes),"classes"in s&&s.classes&&Ct(n,s.classes,"class"),"styles"in s&&s.styles&&Ct(n,s.styles,"style"),{name:s.name||!1,attributes:n}}function Ct(s,n,t){if(typeof n=="string"){s.push(t?[t,n]:[n]);return}for(const e of n)Array.isArray(e)?s.push(e):s.push(t?[t,e]:[e])}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Xs{constructor(...n){l(this,"_patterns",[]);this.add(...n)}add(...n){for(let t of n)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...n){for(const t of n)for(const e of this._patterns){const i=this._isElementMatching(t,e);if(i)return{element:t,pattern:e,match:i}}return null}matchAll(...n){const t=[];for(const e of n)for(const i of this._patterns){const r=this._isElementMatching(e,i);r&&t.push({element:e,pattern:i,match:r})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const n=this._patterns[0],t=n.name;return typeof n!="function"&&t&&!(t instanceof RegExp)?t:null}_isElementMatching(n,t){if(typeof t=="function"){const r=t(n);return!r||typeof r!="object"?r:Ys(r)}const e={};if(t.name&&(e.name=Hs(t.name,n.name),!e.name))return null;const i=[];return t.attributes&&!Zs(t.attributes,n,i)||t.classes&&!Qs(t.classes,n,i)||t.styles&&!tn(t.styles,n,i)?null:(i.length&&(e.attributes=i),e)}}function xt(s,n){return s===!0||s===n||s instanceof RegExp&&!!String(n).match(s)}function Hs(s,n){return s instanceof RegExp?!!n.match(s):s===n}function Xt(s,n){if(Array.isArray(s))return s.map(e=>typeof e!="object"||e instanceof RegExp?n?[n,e,!0]:[e,!0]:((e.key===void 0||e.value===void 0)&&$t("matcher-pattern-missing-key-or-value",e),n?[n,e.key,e.value]:[e.key,e.value]));if(typeof s!="object"||s instanceof RegExp)return[n?[n,s,!0]:[s,!0]];const t=[];for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&t.push(n?[n,e,s[e]]:[e,s[e]]);return t}function Zs(s,n,t){let e;return typeof s=="object"&&!(s instanceof RegExp)&&!Array.isArray(s)?(s.style!==void 0&&$t("matcher-pattern-deprecated-attributes-style-key",s),s.class!==void 0&&$t("matcher-pattern-deprecated-attributes-class-key",s)):e=["class","style"],n._collectAttributesMatch(Xt(s),t,e)}function Qs(s,n,t){return n._collectAttributesMatch(Xt(s,"class"),t)}function tn(s,n,t){return n._collectAttributesMatch(Xt(s,"style"),t)}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ft{constructor(n){l(this,"_styles");l(this,"_cachedStyleNames",null);l(this,"_cachedExpandedStyleNames",null);l(this,"_styleProcessor");this._styles={},this._styleProcessor=n}get isEmpty(){return!Object.entries(this._styles).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(n){this.clear();const t=en(n);for(const[e,i]of t)this._styleProcessor.toNormalizedForm(e,i,this._styles);return this}has(n){if(this.isEmpty)return!1;const e=this._styleProcessor.getReducedForm(n,this._styles).find(([i])=>i===n);return Array.isArray(e)}set(n,t){if(this._cachedStyleNames=null,this._cachedExpandedStyleNames=null,Ut(n))for(const[e,i]of Object.entries(n))this._styleProcessor.toNormalizedForm(e,i,this._styles);else this._styleProcessor.toNormalizedForm(n,t,this._styles)}remove(n){for(const t of Et(n)){this._cachedStyleNames=null,this._cachedExpandedStyleNames=null;const e=sn(t);Ls(this._styles,e),delete this._styles[t],this._cleanEmptyObjectsOnPath(e)}}getNormalized(n){return this._styleProcessor.getNormalized(n,this._styles)}toString(){return this.isEmpty?"":this.getStylesEntries().map(n=>n.join(":")).sort().join(";")+";"}getAsString(n){if(this.isEmpty)return;if(this._styles[n]&&!Ut(this._styles[n]))return this._styles[n];const e=this._styleProcessor.getReducedForm(n,this._styles).find(([i])=>i===n);if(Array.isArray(e))return e[1]}getStyleNames(n=!1){return this.isEmpty?[]:n?(this._cachedExpandedStyleNames||(this._cachedExpandedStyleNames=this._styleProcessor.getStyleNames(this._styles)),this._cachedExpandedStyleNames):(this._cachedStyleNames||(this._cachedStyleNames=this.getStylesEntries().map(([t])=>t)),this._cachedStyleNames)}keys(){return this.getStyleNames()}clear(){this._styles={},this._cachedStyleNames=null,this._cachedExpandedStyleNames=null}isSimilar(n){if(this.size!==n.size)return!1;for(const t of this.getStyleNames())if(!n.has(t)||n.getAsString(t)!==this.getAsString(t))return!1;return!0}getStylesEntries(){const n=[],t=Object.keys(this._styles);for(const e of t)n.push(...this._styleProcessor.getReducedForm(e,this._styles));return n}_clone(){const n=new this.constructor(this._styleProcessor);return n.set(this.getNormalized()),n}_getTokensMatch(n,t){const e=[];for(const i of this.getStyleNames(!0))if(xt(n,i)){if(t===!0){e.push(i);continue}const r=this.getAsString(i);xt(t,r)&&e.push(i)}return e.length?e:void 0}_getConsumables(n){const t=[];if(n){t.push(n);for(const e of this._styleProcessor.getRelatedStyles(n))t.push(e)}else for(const e of this.getStyleNames()){for(const i of this._styleProcessor.getRelatedStyles(e))t.push(i);t.push(e)}return t}_canMergeFrom(n){for(const t of n.getStyleNames())if(this.has(t)&&this.getAsString(t)!==n.getAsString(t))return!1;return!0}_mergeFrom(n){for(const t of n.getStyleNames())this.has(t)||this.set(t,n.getAsString(t))}_isMatching(n){for(const t of n.getStyleNames())if(!this.has(t)||this.getAsString(t)!==n.getAsString(t))return!1;return!0}_cleanEmptyObjectsOnPath(n){const t=n.split(".");if(!(t.length>1))return;const i=t.splice(0,t.length-1).join("."),r=jt(this._styles,i);if(!r)return;!Object.keys(r).length&&this.remove(i)}}function en(s){let n=null,t=0,e=0,i=null;const r=new Map;if(s==="")return r;s.charAt(s.length-1)!=";"&&(s=s+";");for(let o=0;o<s.length;o++){const a=s.charAt(o);if(n===null)switch(a){case":":i||(i=s.substr(t,o-t),e=o+1);break;case'"':case"'":n=a;break;case";":{const f=s.substr(e,o-e);i&&r.set(i.trim(),f.trim()),i=null,t=o+1;break}}else a===n&&(n=null)}return r}function sn(s){return s.replace("-",".")}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class It{constructor(){l(this,"_set",new Set)}get isEmpty(){return this._set.size==0}get size(){return this._set.size}has(n){return this._set.has(n)}keys(){return Array.from(this._set.keys())}setTo(n){this.clear();for(const t of n.split(/\s+/))t&&this._set.add(t);return this}set(n){for(const t of Et(n))t&&this._set.add(t)}remove(n){for(const t of Et(n))this._set.delete(t)}clear(){this._set.clear()}toString(){return Array.from(this._set).join(" ")}isSimilar(n){if(this.size!==n.size)return!1;for(const t of this.keys())if(!n.has(t))return!1;return!0}_clone(){const n=new this.constructor;return n._set=new Set(this._set),n}_getTokensMatch(n){const t=[];if(n===!0){for(const e of this._set.keys())t.push(e);return t}if(typeof n=="string"){for(const e of n.split(/\s+/))if(this._set.has(e))t.push(e);else return;return t}for(const e of this._set.keys())e.match(n)&&t.push(e);return t.length?t:void 0}_getConsumables(n){return n?[n]:this.keys()}_canMergeFrom(){return!0}_mergeFrom(n){for(const t of n._set.keys())this._set.has(t)||this._set.add(t)}_isMatching(n){for(const t of n._set.keys())if(!this._set.has(t))return!1;return!0}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let it=class Fe extends H{constructor(t,e,i,r){super(t);l(this,"name");l(this,"_unsafeAttributesToRender",[]);l(this,"_attrs");l(this,"_children");l(this,"_customProperties",new Map);this.name=e,this._attrs=this._parseAttributes(i),this._children=[],r&&this._insertChild(0,r)}get _classes(){return this._attrs.get("class")}get _styles(){return this._attrs.get("style")}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes&&(yield"class"),this._styles&&(yield"style");for(const t of this._attrs.keys())t!="class"&&t!="style"&&(yield t)}*getAttributes(){for(const[t,e]of this._attrs.entries())yield[t,String(e)]}getAttribute(t){return this._attrs.has(t)?String(this._attrs.get(t)):void 0}hasAttribute(t,e){return this._attrs.has(t)?e!==void 0?Z(this.name,t)||at(this.name,t)?this._attrs.get(t).has(e):this._attrs.get(t)===e:!0:!1}isSimilar(t){if(!(t instanceof Fe))return!1;if(this===t)return!0;if(this.name!=t.name||this._attrs.size!==t._attrs.size)return!1;for(const[e,i]of this._attrs){const r=t._attrs.get(e);if(r===void 0)return!1;if(typeof i=="string"||typeof r=="string"){if(r!==i)return!1}else if(!i.isSimilar(r))return!1}return!0}hasClass(...t){for(const e of t)if(!this._classes||!this._classes.has(e))return!1;return!0}getClassNames(){const t=this._classes?this._classes.keys():[],e=t[Symbol.iterator]();return Object.assign(t,{next:e.next.bind(e)})}getStyle(t){return this._styles&&this._styles.getAsString(t)}getNormalizedStyle(t){return this._styles&&this._styles.getNormalized(t)}getStyleNames(t){return this._styles?this._styles.getStyleNames(t):[]}hasStyle(...t){for(const e of t)if(!this._styles||!this._styles.has(e))return!1;return!0}findAncestor(...t){const e=new Xs(...t);let i=this.parent;for(;i&&!i.is("documentFragment");){if(e.match(i))return i;i=i.parent}return null}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const t=this._classes?this._classes.keys().sort().join(","):"",e=this._styles&&String(this._styles),i=Array.from(this._attrs).filter(([r])=>r!="style"&&r!="class").map(r=>`${r[0]}="${r[1]}"`).sort().join(" ");return this.name+(t==""?"":` class="${t}"`)+(e?` style="${e}"`:"")+(i==""?"":` ${i}`)}shouldRenderUnsafeAttribute(t){return this._unsafeAttributesToRender.includes(t)}_clone(t=!1){const e=[];if(t)for(const r of this.getChildren())e.push(r._clone(t));const i=new this.constructor(this.document,this.name,this._attrs,e);return i._customProperties=new Map(this._customProperties),i.getFillerOffset=this.getFillerOffset,i._unsafeAttributesToRender=this._unsafeAttributesToRender,i}_appendChild(t){return this._insertChild(this.childCount,t)}_insertChild(t,e){this._fireChange("children",this,{index:t});let i=0;const r=nn(this.document,e);for(const o of r)o.parent!==null&&o._remove(),o.parent=this,o.document=this.document,this._children.splice(t,0,o),t++,i++;return i}_removeChildren(t,e=1){this._fireChange("children",this,{index:t});for(let i=t;i<t+e;i++)this._children[i].parent=null;return this._children.splice(t,e)}_setAttribute(t,e,i=!0){if(this._fireChange("attributes",this),Z(this.name,t)||at(this.name,t)){let r=this._attrs.get(t);r||(r=Z(this.name,t)?new Ft(this.document.stylesProcessor):new It,this._attrs.set(t,r)),i?r.setTo(String(e)):Z(this.name,t)?Array.isArray(e)?r.set(e[0],e[1]):r.set(e):r.set(typeof e=="string"?e.split(/\s+/):e)}else this._attrs.set(t,String(e))}_removeAttribute(t,e){if(this._fireChange("attributes",this),e!==void 0&&(Z(this.name,t)||at(this.name,t))){const i=this._attrs.get(t);return i?(at(this.name,t)&&typeof e=="string"&&(e=e.split(/\s+/)),i.remove(e),i.isEmpty?this._attrs.delete(t):!1):!1}return this._attrs.delete(t)}_addClass(t){this._setAttribute("class",t,!1)}_removeClass(t){this._removeAttribute("class",t)}_setStyle(t,e){typeof t!="string"?this._setAttribute("style",t,!1):this._setAttribute("style",[t,e],!1)}_removeStyle(t){this._removeAttribute("style",t)}_collectAttributesMatch(t,e,i){for(const[r,o,a]of t){let f=!1,h=!1;for(const[d,m]of this._attrs)if(!(i&&i.includes(d)||!xt(r,d)))if(f=!0,typeof m=="string"){if(xt(o,m))e.push([d]),h=!0;else if(!(r instanceof RegExp))return!1}else{const p=m._getTokensMatch(o,a||!0);if(p){h=!0;for(const y of p)e.push([d,y])}else if(!(r instanceof RegExp))return!1}if(!f||!h)return!1}return!0}_getConsumables(t,e){const i=[];if(t){const r=this._attrs.get(t);if(r!==void 0)if(typeof r=="string")i.push([t]);else for(const o of r._getConsumables(e))i.push([t,o])}else for(const[r,o]of this._attrs)if(typeof o=="string")i.push([r]);else for(const a of o._getConsumables())i.push([r,a]);return{name:!t,attributes:i}}_canMergeAttributesFrom(t){if(this.name!=t.name)return!1;for(const[e,i]of t._attrs){const r=this._attrs.get(e);if(r!==void 0){if(typeof r=="string"||typeof i=="string"){if(r!==i)return!1}else if(!r._canMergeFrom(i))return!1}}return!0}_mergeAttributesFrom(t){this._fireChange("attributes",this);for(const[e,i]of t._attrs){const r=this._attrs.get(e);r===void 0||typeof r=="string"||typeof i=="string"?this._setAttribute(e,i):r._mergeFrom(i)}}_canSubtractAttributesOf(t){if(this.name!=t.name)return!1;for(const[e,i]of t._attrs){const r=this._attrs.get(e);if(r===void 0)return!1;if(typeof r=="string"||typeof i=="string"){if(r!==i)return!1}else if(!r._isMatching(i))return!1}return!0}_subtractAttributesOf(t){this._fireChange("attributes",this);for(const[e,i]of t._attrs){const r=this._attrs.get(e);typeof r=="string"||typeof i=="string"?this._attrs.delete(e):(r.remove(i.keys()),r.isEmpty&&this._attrs.delete(e))}}_setCustomProperty(t,e){this._customProperties.set(t,e)}_removeCustomProperty(t){return this._customProperties.delete(t)}_parseAttributes(t){const e=yt(t);for(const[i,r]of e)if(r===null)e.delete(i);else if(Z(this.name,i)){const o=r instanceof Ft?r._clone():new Ft(this.document.stylesProcessor).setTo(String(r));e.set(i,o)}else if(at(this.name,i)){const o=r instanceof It?r._clone():new It().setTo(String(r));e.set(i,o)}else typeof r!="string"&&e.set(i,String(r));return e}};it.prototype.is=function(s,n){return n?n===this.name&&(s==="element"||s==="view:element"):s==="element"||s==="view:element"||s==="node"||s==="view:node"};function nn(s,n){if(typeof n=="string")return[new G(s,n)];q(n)||(n=[n]);const t=[];for(const e of n)typeof e=="string"?t.push(new G(s,e)):e instanceof V?t.push(new G(s,e.data)):t.push(e);return t}function at(s,n){return n=="class"||s=="a"&&n=="rel"}function Z(s,n){return n=="style"}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ie extends it{constructor(n,t,e,i){super(n,t,e,i),this.getFillerOffset=rn}}Ie.prototype.is=function(s,n){return n?n===this.name&&(s==="containerElement"||s==="view:containerElement"||s==="element"||s==="view:element"):s==="containerElement"||s==="view:containerElement"||s==="element"||s==="view:element"||s==="node"||s==="view:node"};function rn(){const s=[...this.getChildren()],n=s[this.childCount-1];if(n&&n.is("element","br"))return this.childCount;for(const t of s)if(!t.is("uiElement"))return null;return this.childCount}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Ht extends Yt(Ie){constructor(n,t,e,i){super(n,t,e,i),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("placeholder",void 0),this.bind("isReadOnly").to(n),this.bind("isFocused").to(n,"isFocused",r=>r&&n.selection.editableElement==this),this.listenTo(n.selection,"change",()=>{this.isFocused=n.isFocused&&n.selection.editableElement==this})}destroy(){this.stopListening()}}Ht.prototype.is=function(s,n){return n?n===this.name&&(s==="editableElement"||s==="view:editableElement"||s==="containerElement"||s==="view:containerElement"||s==="element"||s==="view:element"):s==="editableElement"||s==="view:editableElement"||s==="containerElement"||s==="view:containerElement"||s==="element"||s==="view:element"||s==="node"||s==="view:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const pe=Symbol("rootName");class on extends Ht{constructor(n,t){super(n,t),this.rootName="main"}get rootName(){return this.getCustomProperty(pe)}set rootName(n){this._setCustomProperty(pe,n)}set _name(n){this.name=n}}on.prototype.is=function(s,n){return n?n===this.name&&(s==="rootElement"||s==="view:rootElement"||s==="editableElement"||s==="view:editableElement"||s==="containerElement"||s==="view:containerElement"||s==="element"||s==="view:element"):s==="rootElement"||s==="view:rootElement"||s==="editableElement"||s==="view:editableElement"||s==="containerElement"||s==="view:containerElement"||s==="element"||s==="view:element"||s==="node"||s==="view:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let et=class{constructor(n={}){l(this,"direction");l(this,"boundaries");l(this,"singleCharacters");l(this,"shallow");l(this,"ignoreElementEnd");l(this,"_position");l(this,"_boundaryStartParent");l(this,"_boundaryEndParent");if(!n.boundaries&&!n.startPosition)throw new u("view-tree-walker-no-start-position",null);if(n.direction&&n.direction!="forward"&&n.direction!="backward")throw new u("view-tree-walker-unknown-direction",n.startPosition,{direction:n.direction});this.boundaries=n.boundaries||null,n.startPosition?this._position=w._createAt(n.startPosition):this._position=w._createAt(n.boundaries[n.direction=="backward"?"end":"start"]),this.direction=n.direction||"forward",this.singleCharacters=!!n.singleCharacters,this.shallow=!!n.shallow,this.ignoreElementEnd=!!n.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}get position(){return this._position}skip(n){let t,e;do e=this.position,t=this.next();while(!t.done&&n(t.value));t.done||(this._position=e)}jumpTo(n){this._boundaryStartParent&&n.isBefore(this.boundaries.start)?n=this.boundaries.start:this._boundaryEndParent&&n.isAfter(this.boundaries.end)&&(n=this.boundaries.end),this._position=n.clone()}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let n=this.position.clone();const t=this.position,e=n.parent;if(e.parent===null&&n.offset===e.childCount)return{done:!0,value:void 0};if(e===this._boundaryEndParent&&n.offset==this.boundaries.end.offset)return{done:!0,value:void 0};let i;if(e&&e.is("view:$text")){if(n.isAtEnd)return this._position=w._createAfter(e),this._next();i=e.data[n.offset]}else i=e.getChild(n.offset);if(typeof i=="string"){let r;this.singleCharacters?r=1:r=(e===this._boundaryEndParent?this.boundaries.end.offset:e.data.length)-n.offset;const o=new V(e,n.offset,r);return n.offset+=r,this._position=n,this._formatReturnValue("text",o,t,n,r)}if(i&&i.is("view:element")){if(!this.shallow)n=new w(i,0);else{if(this.boundaries&&this.boundaries.end.isBefore(n))return{done:!0,value:void 0};n.offset++}return this._position=n,this._formatReturnValue("elementStart",i,t,n,1)}if(i&&i.is("view:$text")){if(this.singleCharacters)return n=new w(i,0),this._position=n,this._next();let r=i.data.length,o;return i==this._boundaryEndParent?(r=this.boundaries.end.offset,o=new V(i,0,r),n=w._createAfter(o)):(o=new V(i,0,i.data.length),n.offset++),this._position=n,this._formatReturnValue("text",o,t,n,r)}return n=w._createAfter(e),this._position=n,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",e,t,n)}_previous(){let n=this.position.clone();const t=this.position,e=n.parent;if(e.parent===null&&n.offset===0)return{done:!0,value:void 0};if(e==this._boundaryStartParent&&n.offset==this.boundaries.start.offset)return{done:!0,value:void 0};let i;if(e.is("view:$text")){if(n.isAtStart)return this._position=w._createBefore(e),this._previous();i=e.data[n.offset-1]}else i=e.getChild(n.offset-1);if(typeof i=="string"){let r;if(this.singleCharacters)r=1;else{const a=e===this._boundaryStartParent?this.boundaries.start.offset:0;r=n.offset-a}n.offset-=r;const o=new V(e,n.offset,r);return this._position=n,this._formatReturnValue("text",o,t,n,r)}if(i&&i.is("view:element"))return this.shallow?(n.offset--,this._position=n,this._formatReturnValue("elementStart",i,t,n,1)):(n=new w(i,i.childCount),this._position=n,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",i,t,n));if(i&&i.is("view:$text")){if(this.singleCharacters)return n=new w(i,i.data.length),this._position=n,this._previous();let r=i.data.length,o;if(i==this._boundaryStartParent){const a=this.boundaries.start.offset;o=new V(i,a,i.data.length-a),r=o.data.length,n=w._createBefore(o)}else o=new V(i,0,i.data.length),n.offset--;return this._position=n,this._formatReturnValue("text",o,t,n,r)}return n=w._createBefore(e),this._position=n,this._formatReturnValue("elementStart",e,t,n,1)}_formatReturnValue(n,t,e,i,r){return t.is("view:$textProxy")&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(i=w._createAfter(t.textNode),this._position=i):e=w._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(i=w._createBefore(t.textNode),this._position=i):e=w._createBefore(t.textNode))),{done:!1,value:{type:n,item:t,previousPosition:e,nextPosition:i,length:r}}}};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let w=class L extends X{constructor(t,e){super();l(this,"parent");l(this,"offset");this.parent=t,this.offset=e}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const t=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===t}get root(){return this.parent.root}get editableElement(){let t=this.parent;for(;!(t instanceof Ht);)if(t.parent)t=t.parent;else return null;return t}getShiftedBy(t){const e=L._createAt(this),i=e.offset+t;return e.offset=i<0?0:i,e}getLastMatchingPosition(t,e={}){e.startPosition=this;const i=new et(e);return i.skip(t),i.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(t){const e=this.getAncestors(),i=t.getAncestors();let r=0;for(;e[r]==i[r]&&e[r];)r++;return r===0?null:e[r-1]}isEqual(t){return this.parent==t.parent&&this.offset==t.offset}isBefore(t){return this.compareWith(t)=="before"}isAfter(t){return this.compareWith(t)=="after"}compareWith(t){if(this.root!==t.root)return"different";if(this.isEqual(t))return"same";const e=this.parent.is("node")?this.parent.getPath():[],i=t.parent.is("node")?t.parent.getPath():[];e.push(this.offset),i.push(t.offset);const r=N(e,i);switch(r){case"prefix":return"before";case"extension":return"after";default:return e[r]<i[r]?"before":"after"}}getWalker(t={}){return t.startPosition=this,new et(t)}clone(){return new L(this.parent,this.offset)}static _createAt(t,e){if(t instanceof L)return new this(t.parent,t.offset);{const i=t;if(e=="end")e=i.is("$text")?i.data.length:i.childCount;else{if(e=="before")return this._createBefore(i);if(e=="after")return this._createAfter(i);if(e!==0&&!e)throw new u("view-createpositionat-offset-required",i)}return new L(i,e)}}static _createAfter(t){if(t.is("$textProxy"))return new L(t.textNode,t.offsetInText+t.data.length);if(!t.parent)throw new u("view-position-after-root",t,{root:t});return new L(t.parent,t.index+1)}static _createBefore(t){if(t.is("$textProxy"))return new L(t.textNode,t.offsetInText);if(!t.parent)throw new u("view-position-before-root",t,{root:t});return new L(t.parent,t.index)}};w.prototype.is=function(s){return s==="position"||s==="view:position"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let F=class J extends X{constructor(t,e=null){super();l(this,"start");l(this,"end");this.start=t.clone(),this.end=e?e.clone():t.clone()}*[Symbol.iterator](){yield*new et({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let t=this.start.getLastMatchingPosition(St,{direction:"backward"}),e=this.end.getLastMatchingPosition(St);return t.parent.is("$text")&&t.isAtStart&&(t=w._createBefore(t.parent)),e.parent.is("$text")&&e.isAtEnd&&(e=w._createAfter(e.parent)),new J(t,e)}getTrimmed(){let t=this.start.getLastMatchingPosition(St);if(t.isAfter(this.end)||t.isEqual(this.end))return new J(t,t);let e=this.end.getLastMatchingPosition(St,{direction:"backward"});const i=t.nodeAfter,r=e.nodeBefore;return i&&i.is("$text")&&(t=new w(i,0)),r&&r.is("$text")&&(e=new w(r,r.data.length)),new J(t,e)}isEqual(t){return this==t||this.start.isEqual(t.start)&&this.end.isEqual(t.end)}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,e=!1){t.isCollapsed&&(e=!1);const i=this.containsPosition(t.start)||e&&this.start.isEqual(t.start),r=this.containsPosition(t.end)||e&&this.end.isEqual(t.end);return i&&r}getDifference(t){const e=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&e.push(new J(this.start,t.start)),this.containsPosition(t.end)&&e.push(new J(t.end,this.end))):e.push(this.clone()),e}getIntersection(t){if(this.isIntersecting(t)){let e=this.start,i=this.end;return this.containsPosition(t.start)&&(e=t.start),this.containsPosition(t.end)&&(i=t.end),new J(e,i)}return null}getWalker(t={}){return t.boundaries=this,new et(t)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let t=this.start.nodeAfter,e=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(t=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(e=this.end.parent.previousSibling),t&&t.is("element")&&t===e?t:null}clone(){return new J(this.start,this.end)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const e=new et(t);for(const i of e)yield i.item}*getPositions(t={}){t.boundaries=this;const e=new et(t);yield e.position;for(const i of e)yield i.nextPosition}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}static _createFromParentsAndOffsets(t,e,i,r){return new this(new w(t,e),new w(i,r))}static _createFromPositionAndShift(t,e){const i=t,r=t.getShiftedBy(e);return e>0?new this(i,r):new this(r,i)}static _createIn(t){return this._createFromParentsAndOffsets(t,0,t,t.childCount)}static _createOn(t){const e=t.is("$textProxy")?t.offsetSize:1;return this._createFromPositionAndShift(w._createBefore(t),e)}};F.prototype.is=function(s){return s==="range"||s==="view:range"};function St(s){return!!(s.item.is("attributeElement")||s.item.is("uiElement"))}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let Le=class Ve extends E(X){constructor(...t){super();l(this,"_ranges");l(this,"_lastRangeBackward");l(this,"_isFake");l(this,"_fakeSelectionLabel");this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",t.length&&this.setTo(...t)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.end:t.start).clone()}get focus(){if(!this._ranges.length)return null;const t=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?t.start:t.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const t of this._ranges)yield t.clone()}getFirstRange(){let t=null;for(const e of this._ranges)(!t||e.start.isBefore(t.start))&&(t=e);return t?t.clone():null}getLastRange(){let t=null;for(const e of this._ranges)(!t||e.end.isAfter(t.end))&&(t=e);return t?t.clone():null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}isEqual(t){if(this.isFake!=t.isFake||this.isFake&&this.fakeSelectionLabel!=t.fakeSelectionLabel||this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const e of this._ranges){let i=!1;for(const r of t._ranges)if(e.isEqual(r)){i=!0;break}if(!i)return!1}return!0}isSimilar(t){if(this.isBackward!=t.isBackward)return!1;const e=ce(this.getRanges()),i=ce(t.getRanges());if(e!=i)return!1;if(e==0)return!0;for(let r of this.getRanges()){r=r.getTrimmed();let o=!1;for(let a of t.getRanges())if(a=a.getTrimmed(),r.start.isEqual(a.start)&&r.end.isEqual(a.end)){o=!0;break}if(!o)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(...t){let[e,i,r]=t;if(typeof i=="object"&&(r=i,i=void 0),e===null)this._setRanges([]),this._setFakeOptions(r);else if(e instanceof Ve||e instanceof De)this._setRanges(e.getRanges(),e.isBackward),this._setFakeOptions({fake:e.isFake,label:e.fakeSelectionLabel});else if(e instanceof F)this._setRanges([e],r&&r.backward),this._setFakeOptions(r);else if(e instanceof w)this._setRanges([new F(e)]),this._setFakeOptions(r);else if(e instanceof H){const o=!!r&&!!r.backward;let a;if(i===void 0)throw new u("view-selection-setto-required-second-parameter",this);i=="in"?a=F._createIn(e):i=="on"?a=F._createOn(e):a=new F(w._createAt(e,i)),this._setRanges([a],o),this._setFakeOptions(r)}else if(q(e))this._setRanges(e,r&&r.backward),this._setFakeOptions(r);else throw new u("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(t,e){if(this.anchor===null)throw new u("view-selection-setfocus-no-ranges",this);const i=w._createAt(t,e);if(i.compareWith(this.focus)=="same")return;const r=this.anchor;this._ranges.pop(),i.compareWith(r)=="before"?this._addRange(new F(i,r),!0):this._addRange(new F(r,i)),this.fire("change")}_setRanges(t,e=!1){t=Array.from(t),this._ranges=[];for(const i of t)this._addRange(i);this._lastRangeBackward=!!e}_setFakeOptions(t={}){this._isFake=!!t.fake,this._fakeSelectionLabel=t.fake&&t.label||""}_addRange(t,e=!1){if(!(t instanceof F))throw new u("view-selection-add-range-not-range",this);this._pushRange(t),this._lastRangeBackward=!!e}_pushRange(t){for(const e of this._ranges)if(t.isIntersecting(e))throw new u("view-selection-range-intersects",this,{addedRange:t,intersectingRange:e});this._ranges.push(new F(t.start,t.end))}};Le.prototype.is=function(s){return s==="selection"||s==="view:selection"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let De=class extends E(X){constructor(...t){super();l(this,"_selection");this._selection=new Le,this._selection.delegate("change").to(this),t.length&&this._selection.setTo(...t)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(t){return this._selection.isEqual(t)}isSimilar(t){return this._selection.isSimilar(t)}_setTo(...t){this._selection.setTo(...t)}_setFocus(t,e){this._selection.setFocus(t,e)}};De.prototype.is=function(s){return s==="selection"||s=="documentSelection"||s=="view:selection"||s=="view:documentSelection"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class an extends nt{constructor(t,e,i){super(t,e);l(this,"startRange");l(this,"_eventPhase");l(this,"_currentTarget");this.startRange=i,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const Lt=Symbol("bubbling contexts");function _e(s){class n extends s{fire(e,...i){try{const r=e instanceof nt?e:new nt(this,e),o=Vt(this);if(!o.size)return;if(lt(r,"capturing",this),Q(o,"$capture",r,...i))return r.return;const a=r.startRange||this.selection.getFirstRange(),f=a?a.getContainedElement():null,h=f?!!qe(o,f):!1;let d=f||ln(a);if(lt(r,"atTarget",d),!h){if(Q(o,"$text",r,...i))return r.return;lt(r,"bubbling",d)}for(;d;){if(d.is("rootElement")){if(Q(o,"$root",r,...i))return r.return}else if(d.is("element")&&Q(o,d.name,r,...i))return r.return;if(Q(o,d,r,...i))return r.return;d=d.parent,lt(r,"bubbling",d)}return lt(r,"bubbling",this),Q(o,"$document",r,...i),r.return}catch(r){/* istanbul ignore next -- @preserve */u.rethrowUnexpectedError(r,this)}}_addEventListener(e,i,r){const o=Et(r.context||"$document"),a=Vt(this);for(const f of o){let h=a.get(f);h||(h=new(E()),a.set(f,h)),this.listenTo(h,e,i,r)}}_removeEventListener(e,i){const r=Vt(this);for(const o of r.values())this.stopListening(o,e,i)}}return n}{const s=_e(Object);["fire","_addEventListener","_removeEventListener"].forEach(n=>{_e[n]=s.prototype[n]})}function lt(s,n,t){s instanceof an&&(s._eventPhase=n,s._currentTarget=t)}function Q(s,n,t,...e){const i=typeof n=="string"?s.get(n):qe(s,n);return i?(i.fire(t,...e),t.stop.called):!1}function qe(s,n){for(const[t,e]of s)if(typeof t=="function"&&t(n))return e;return null}function Vt(s){return s[Lt]||(s[Lt]=new Map),s[Lt]}function ln(s){if(!s)return null;const n=s.start.parent,t=s.end.parent,e=n.getPath(),i=t.getPath();return e.length>i.length?n:t}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const ye=10;class Je extends it{constructor(t,e,i,r){super(t,e,i,r);l(this,"_priority",ye);l(this,"_id",null);l(this,"_clonesGroup",null);this.getFillerOffset=hn}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new u("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(t){return this.id!==null||t.id!==null?this.id===t.id:super.isSimilar(t)&&this.priority==t.priority}_clone(t=!1){const e=super._clone(t);return e._priority=this._priority,e._id=this._id,e}_canMergeAttributesFrom(t){return this.id!==null||t.id!==null||this.priority!==t.priority?!1:super._canMergeAttributesFrom(t)}_canSubtractAttributesOf(t){return this.id!==null||t.id!==null||this.priority!==t.priority?!1:super._canSubtractAttributesOf(t)}}l(Je,"DEFAULT_PRIORITY",ye);Je.prototype.is=function(s,n){return n?n===this.name&&(s==="attributeElement"||s==="view:attributeElement"||s==="element"||s==="view:element"):s==="attributeElement"||s==="view:attributeElement"||s==="element"||s==="view:element"||s==="node"||s==="view:node"};function hn(){if(Dt(this))return null;let s=this.parent;for(;s&&s.is("attributeElement");){if(Dt(s)>1)return null;s=s.parent}return!s||Dt(s)>1?null:this.childCount}function Dt(s){return Array.from(s.getChildren()).filter(n=>!n.is("uiElement")).length}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class fn extends it{constructor(n,t,e,i){super(n,t,e,i),this.getFillerOffset=un}_insertChild(n,t){if(t&&(t instanceof H||Array.from(t).length>0))throw new u("view-emptyelement-cannot-add",[this,t]);return 0}}fn.prototype.is=function(s,n){return n?n===this.name&&(s==="emptyElement"||s==="view:emptyElement"||s==="element"||s==="view:element"):s==="emptyElement"||s==="view:emptyElement"||s==="element"||s==="view:element"||s==="node"||s==="view:node"};function un(){return null}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class cn extends it{constructor(n,t,e,i){super(n,t,e,i),this.getFillerOffset=dn}_insertChild(n,t){if(t&&(t instanceof H||Array.from(t).length>0))throw new u("view-uielement-cannot-add",[this,t]);return 0}render(n,t){return this.toDomElement(n)}toDomElement(n){const t=n.createElement(this.name);for(const e of this.getAttributeKeys())t.setAttribute(e,this.getAttribute(e));return t}}cn.prototype.is=function(s,n){return n?n===this.name&&(s==="uiElement"||s==="view:uiElement"||s==="element"||s==="view:element"):s==="uiElement"||s==="view:uiElement"||s==="element"||s==="view:element"||s==="node"||s==="view:node"};function dn(){return null}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class gn extends it{constructor(n,t,e,i){super(n,t,e,i),this.getFillerOffset=mn}_insertChild(n,t){if(t&&(t instanceof H||Array.from(t).length>0))throw new u("view-rawelement-cannot-add",[this,t]);return 0}render(n,t){}}gn.prototype.is=function(s,n){return n?n===this.name&&(s==="rawElement"||s==="view:rawElement"||s==="element"||s==="view:element"):s==="rawElement"||s==="view:rawElement"||s===this.name||s==="view:"+this.name||s==="element"||s==="view:element"||s==="node"||s==="view:node"};function mn(){return null}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */let pn=class extends E(X){constructor(t,e){super();l(this,"document");l(this,"_children",[]);l(this,"_customProperties",new Map);this.document=t,e&&this._insertChild(0,e)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}get name(){}get getFillerOffset(){}getCustomProperty(t){return this._customProperties.get(t)}*getCustomProperties(){yield*this._customProperties.entries()}_appendChild(t){return this._insertChild(this.childCount,t)}getChild(t){return this._children[t]}getChildIndex(t){return this._children.indexOf(t)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(t,e){this._fireChange("children",this,{index:t});let i=0;const r=_n(this.document,e);for(const o of r)o.parent!==null&&o._remove(),o.parent=this,this._children.splice(t,0,o),t++,i++;return i}_removeChildren(t,e=1){this._fireChange("children",this,{index:t});for(let i=t;i<t+e;i++)this._children[i].parent=null;return this._children.splice(t,e)}_fireChange(t,e,i){this.fire(`change:${t}`,e,i)}_setCustomProperty(t,e){this._customProperties.set(t,e)}_removeCustomProperty(t){return this._customProperties.delete(t)}};pn.prototype.is=function(s){return s==="documentFragment"||s==="view:documentFragment"};function _n(s,n){return typeof n=="string"?[new G(s,n)]:(q(n)||(n=[n]),Array.from(n).map(t=>typeof t=="string"?new G(s,t):t instanceof V?new G(s,t.data):t))}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const yn=s=>s.createTextNode(" "),wn=s=>{const n=s.createElement("span");return n.dataset.ckeFiller="true",n.innerText=" ",n},Pn=s=>{const n=s.createElement("br");return n.dataset.ckeFiller="true",n};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */Pn(j.document);yn(j.document);wn(j.document);/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class z{is(){throw new Error("is() method is abstract")}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Y extends z{constructor(t,e,i){super();l(this,"textNode");l(this,"data");l(this,"offsetInText");if(this.textNode=t,e<0||e>t.offsetSize)throw new u("model-textproxy-wrong-offsetintext",this);if(i<0||e+i>t.offsetSize)throw new u("model-textproxy-wrong-length",this);this.data=t.data.substring(e,e+i),this.offsetInText=e}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}getPath(){const t=this.textNode.getPath();return t.length>0&&(t[t.length-1]+=this.offsetInText),t}getAncestors(t={}){const e=[];let i=t.includeSelf?this:this.parent;for(;i;)e[t.parentFirst?"push":"unshift"](i),i=i.parent;return e}hasAttribute(t){return this.textNode.hasAttribute(t)}getAttribute(t){return this.textNode.getAttribute(t)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}Y.prototype.is=function(s){return s==="$textProxy"||s==="model:$textProxy"||s==="textProxy"||s==="model:textProxy"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class ut{constructor(n){l(this,"direction");l(this,"boundaries");l(this,"singleCharacters");l(this,"shallow");l(this,"ignoreElementEnd");l(this,"_position");l(this,"_boundaryStartParent");l(this,"_boundaryEndParent");l(this,"_visitedParent");if(!n||!n.boundaries&&!n.startPosition)throw new u("model-tree-walker-no-start-position",null);const t=n.direction||"forward";if(t!="forward"&&t!="backward")throw new u("model-tree-walker-unknown-direction",n,{direction:t});this.direction=t,this.boundaries=n.boundaries||null,n.startPosition?this._position=n.startPosition.clone():this._position=g._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!n.singleCharacters,this.shallow=!!n.shallow,this.ignoreElementEnd=!!n.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}get position(){return this._position}skip(n){let t,e,i,r;do i=this.position,r=this._visitedParent,{done:t,value:e}=this.next();while(!t&&n(e));t||(this._position=i,this._visitedParent=r)}jumpTo(n){this._boundaryStartParent&&n.isBefore(this.boundaries.start)?n=this.boundaries.start:this._boundaryEndParent&&n.isAfter(this.boundaries.end)&&(n=this.boundaries.end),this._position=n.clone(),this._visitedParent=n.parent}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const n=this.position,t=this.position.clone(),e=this._visitedParent;if(e.parent===null&&t.offset===e.maxOffset)return{done:!0,value:void 0};if(e===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0,value:void 0};const i=mt(t,e),r=i||$e(t,e,i);if(r&&r.is("model:element")){if(!this.shallow)t.path.push(0),this._visitedParent=r;else{if(this.boundaries&&this.boundaries.end.isBefore(t))return{done:!0,value:void 0};t.offset++}return this._position=t,K("elementStart",r,n,t,1)}if(r&&r.is("model:$text")){let o;if(this.singleCharacters)o=1;else{let h=r.endOffset;this._boundaryEndParent==e&&this.boundaries.end.offset<h&&(h=this.boundaries.end.offset),o=h-t.offset}const a=t.offset-r.startOffset,f=new Y(r,a,o);return t.offset+=o,this._position=t,K("text",f,n,t,o)}return t.path.pop(),t.offset++,this._position=t,this._visitedParent=e.parent,this.ignoreElementEnd?this._next():K("elementEnd",e,n,t)}_previous(){const n=this.position,t=this.position.clone(),e=this._visitedParent;if(e.parent===null&&t.offset===0)return{done:!0,value:void 0};if(e==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0,value:void 0};const i=t.parent,r=mt(t,i),o=r||We(t,i,r);if(o&&o.is("model:element"))return t.offset--,this.shallow?(this._position=t,K("elementStart",o,n,t,1)):(t.path.push(o.maxOffset),this._position=t,this._visitedParent=o,this.ignoreElementEnd?this._previous():K("elementEnd",o,n,t));if(o&&o.is("model:$text")){let a;if(this.singleCharacters)a=1;else{let d=o.startOffset;this._boundaryStartParent==e&&this.boundaries.start.offset>d&&(d=this.boundaries.start.offset),a=t.offset-d}const f=t.offset-o.startOffset,h=new Y(o,f-a,a);return t.offset-=a,this._position=t,K("text",h,n,t,a)}return t.path.pop(),this._position=t,this._visitedParent=e.parent,K("elementStart",e,n,t,1)}}function K(s,n,t,e,i){return{done:!1,value:{type:s,item:n,previousPosition:t,nextPosition:e,length:i}}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class g extends z{constructor(t,e,i="toNone"){super();l(this,"root");l(this,"path");l(this,"stickiness");if(!t.is("element")&&!t.is("documentFragment"))throw new u("model-position-root-invalid",t);if(!Array.isArray(e)||e.length===0)throw new u("model-position-path-incorrect-format",t,{path:e});t.is("rootElement")?e=e.slice():(e=[...t.getPath(),...e],t=t.root),this.root=t,this.path=e,this.stickiness=i}get offset(){return this.path[this.path.length-1]}set offset(t){this.path[this.path.length-1]=t}get parent(){let t=this.root;for(let e=0;e<this.path.length-1;e++)if(t=t.getChildAtOffset(this.path[e]),!t)throw new u("model-position-path-incorrect",this,{position:this});if(t.is("$text"))throw new u("model-position-path-incorrect",this,{position:this});return t}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return mt(this,this.parent)}get nodeAfter(){const t=this.parent;return $e(this,t,mt(this,t))}get nodeBefore(){const t=this.parent;return We(this,t,mt(this,t))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}isValid(){if(this.offset<0)return!1;let t=this.root;for(let e=0;e<this.path.length-1;e++)if(t=t.getChildAtOffset(this.path[e]),!t)return!1;return this.offset<=t.maxOffset}compareWith(t){if(this.root!=t.root)return"different";const e=N(this.path,t.path);switch(e){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[e]<t.path[e]?"before":"after"}}getLastMatchingPosition(t,e={}){e.startPosition=this;const i=new ut(e);return i.skip(t),i.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const t=this.parent;return t.is("documentFragment")?[t]:t.getAncestors({includeSelf:!0})}findAncestor(t){const e=this.parent;return e.is("element")?e.findAncestor(t,{includeSelf:!0}):null}getCommonPath(t){if(this.root!=t.root)return[];const e=N(this.path,t.path),i=typeof e=="string"?Math.min(this.path.length,t.path.length):e;return this.path.slice(0,i)}getCommonAncestor(t){const e=this.getAncestors(),i=t.getAncestors();let r=0;for(;e[r]==i[r]&&e[r];)r++;return r===0?null:e[r-1]}getShiftedBy(t){const e=this.clone(),i=e.offset+t;return e.offset=i<0?0:i,e}isAfter(t){return this.compareWith(t)=="after"}isBefore(t){return this.compareWith(t)=="before"}isEqual(t){return this.compareWith(t)=="same"}isTouching(t){if(this.root!==t.root)return!1;const e=Math.min(this.path.length,t.path.length);for(let i=0;i<e;i++){const r=this.path[i]-t.path[i];if(r<-1||r>1)return!1;if(r===1)return we(t,this,i);if(r===-1)return we(this,t,i)}return this.path.length===t.path.length?!0:this.path.length>t.path.length?Gt(this.path,e):Gt(t.path,e)}hasSameParentAs(t){if(this.root!==t.root)return!1;const e=this.getParentPath(),i=t.getParentPath();return N(e,i)=="same"}getTransformedByOperation(t){let e;switch(t.type){case"insert":e=this._getTransformedByInsertOperation(t);break;case"move":case"remove":case"reinsert":e=this._getTransformedByMoveOperation(t);break;case"split":e=this._getTransformedBySplitOperation(t);break;case"merge":e=this._getTransformedByMergeOperation(t);break;default:e=g._createAt(this);break}return e}_getTransformedByInsertOperation(t){return this._getTransformedByInsertion(t.position,t.howMany)}_getTransformedByMoveOperation(t){return this._getTransformedByMove(t.sourcePosition,t.targetPosition,t.howMany)}_getTransformedBySplitOperation(t){const e=t.movedRange;return e.containsPosition(this)||e.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(t.splitPosition,t.moveTargetPosition):t.graveyardPosition?this._getTransformedByMove(t.graveyardPosition,t.insertionPosition,1):this._getTransformedByInsertion(t.insertionPosition,1)}_getTransformedByMergeOperation(t){const e=t.movedRange,i=e.containsPosition(this)||e.start.isEqual(this);let r;return i?(r=this._getCombined(t.sourcePosition,t.targetPosition),t.sourcePosition.isBefore(t.targetPosition)&&(r=r._getTransformedByDeletion(t.deletionPosition,1))):this.isEqual(t.deletionPosition)?r=g._createAt(t.deletionPosition):r=this._getTransformedByMove(t.deletionPosition,t.graveyardPosition,1),r}_getTransformedByDeletion(t,e){const i=g._createAt(this);if(this.root!=t.root)return i;if(N(t.getParentPath(),this.getParentPath())=="same"){if(t.offset<this.offset){if(t.offset+e>this.offset)return null;i.offset-=e}}else if(N(t.getParentPath(),this.getParentPath())=="prefix"){const r=t.path.length-1;if(t.offset<=this.path[r]){if(t.offset+e>this.path[r])return null;i.path[r]-=e}}return i}_getTransformedByInsertion(t,e){const i=g._createAt(this);if(this.root!=t.root)return i;if(N(t.getParentPath(),this.getParentPath())=="same")(t.offset<this.offset||t.offset==this.offset&&this.stickiness!="toPrevious")&&(i.offset+=e);else if(N(t.getParentPath(),this.getParentPath())=="prefix"){const r=t.path.length-1;t.offset<=this.path[r]&&(i.path[r]+=e)}return i}_getTransformedByMove(t,e,i){if(e=e._getTransformedByDeletion(t,i),t.isEqual(e))return g._createAt(this);const r=this._getTransformedByDeletion(t,i);return r===null||t.isEqual(this)&&this.stickiness=="toNext"||t.getShiftedBy(i).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(t,e):r._getTransformedByInsertion(e,i)}_getCombined(t,e){const i=t.path.length-1,r=g._createAt(e);return r.stickiness=this.stickiness,r.offset=r.offset+this.path[i]-t.offset,r.path=[...r.path,...this.path.slice(i+1)],r}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(t,e,i="toNone"){if(t.is("model:position"))return new g(t.root,t.path,t.stickiness);{const r=t;if(e=="end")e=r.maxOffset;else{if(e=="before")return this._createBefore(r,i);if(e=="after")return this._createAfter(r,i);if(e!==0&&!e)throw new u("model-createpositionat-offset-required",[this,t])}if(!r.is("element")&&!r.is("documentFragment"))throw new u("model-position-parent-incorrect",[this,t]);const o=r.getPath();return o.push(e),new this(r.root,o,i)}}static _createAfter(t,e){if(!t.parent)throw new u("model-position-after-root",[this,t],{root:t});return this._createAt(t.parent,t.endOffset,e)}static _createBefore(t,e){if(!t.parent)throw new u("model-position-before-root",t,{root:t});return this._createAt(t.parent,t.startOffset,e)}static fromJSON(t,e){if(t.root==="$graveyard"){const i=new g(e.graveyard,t.path);return i.stickiness=t.stickiness,i}if(!e.getRoot(t.root))throw new u("model-position-fromjson-no-root",e,{rootName:t.root});return new g(e.getRoot(t.root),t.path,t.stickiness)}}g.prototype.is=function(s){return s==="position"||s==="model:position"};function mt(s,n){const t=n.getChildAtOffset(s.offset);return t&&t.is("$text")&&t.startOffset<s.offset?t:null}function $e(s,n,t){return t!==null?null:n.getChildAtOffset(s.offset)}function We(s,n,t){return t!==null?null:n.getChild(n.offsetToIndex(s.offset)-1)}function we(s,n,t){return!(t+1===s.path.length||!Gt(n.path,t+1)||!vn(s,t+1))}function Gt(s,n){for(;n<s.length;){if(s[n]!==0)return!1;n++}return!0}function vn(s,n){let t=s.parent,e=s.path.length-1,i=0;for(;e>=n;){if(s.path[e]+i!==t.maxOffset)return!1;i=1,e--,t=t.parent}return!0}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class c extends z{constructor(t,e){super();l(this,"start");l(this,"end");this.start=g._createAt(t),this.end=e?g._createAt(e):g._createAt(t),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new ut({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const t=this.start.getParentPath(),e=this.end.getParentPath();return N(t,e)=="same"}get root(){return this.start.root}containsPosition(t){return t.isAfter(this.start)&&t.isBefore(this.end)}containsRange(t,e=!1){t.isCollapsed&&(e=!1);const i=this.containsPosition(t.start)||e&&this.start.isEqual(t.start),r=this.containsPosition(t.end)||e&&this.end.isEqual(t.end);return i&&r}containsItem(t){const e=g._createBefore(t);return this.containsPosition(e)||this.start.isEqual(e)}isEqual(t){return this.start.isEqual(t.start)&&this.end.isEqual(t.end)}isIntersecting(t){return this.start.isBefore(t.end)&&this.end.isAfter(t.start)}getDifference(t){const e=[];return this.isIntersecting(t)?(this.containsPosition(t.start)&&e.push(new c(this.start,t.start)),this.containsPosition(t.end)&&e.push(new c(t.end,this.end))):e.push(new c(this.start,this.end)),e}getIntersection(t){if(this.isIntersecting(t)){let e=this.start,i=this.end;return this.containsPosition(t.start)&&(e=t.start),this.containsPosition(t.end)&&(i=t.end),new c(e,i)}return null}getJoined(t,e=!1){let i=this.isIntersecting(t);if(i||(this.start.isBefore(t.start)?i=e?this.end.isTouching(t.start):this.end.isEqual(t.start):i=e?t.end.isTouching(this.start):t.end.isEqual(this.start)),!i)return null;let r=this.start,o=this.end;return t.start.isBefore(r)&&(r=t.start),t.end.isAfter(o)&&(o=t.end),new c(r,o)}getMinimalFlatRanges(){const t=[],e=this.start.getCommonPath(this.end).length,i=g._createAt(this.start);let r=i.parent;for(;i.path.length>e+1;){const o=r.maxOffset-i.offset;o!==0&&t.push(new c(i,i.getShiftedBy(o))),i.path=i.path.slice(0,-1),i.offset++,r=r.parent}for(;i.path.length<=this.end.path.length;){const o=this.end.path[i.path.length-1],a=o-i.offset;a!==0&&t.push(new c(i,i.getShiftedBy(a))),i.offset=o,i.path.push(0)}return t}getWalker(t={}){return t.boundaries=this,new ut(t)}*getItems(t={}){t.boundaries=this,t.ignoreElementEnd=!0;const e=new ut(t);for(const i of e)yield i.item}*getPositions(t={}){t.boundaries=this;const e=new ut(t);yield e.position;for(const i of e)yield i.nextPosition}getTransformedByOperation(t){switch(t.type){case"insert":return this._getTransformedByInsertOperation(t);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(t);case"split":return[this._getTransformedBySplitOperation(t)];case"merge":return[this._getTransformedByMergeOperation(t)]}return[new c(this.start,this.end)]}getTransformedByOperations(t){const e=[new c(this.start,this.end)];for(const i of t)for(let r=0;r<e.length;r++){const o=e[r].getTransformedByOperation(i);e.splice(r,1,...o),r+=o.length-1}for(let i=0;i<e.length;i++){const r=e[i];for(let o=i+1;o<e.length;o++){const a=e[o];(r.containsRange(a)||a.containsRange(r)||r.isEqual(a))&&e.splice(o,1)}}return e}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const t=this.start.nodeAfter,e=this.end.nodeBefore;return t&&t.is("element")&&t===e?t:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(t,e=!1){return this._getTransformedByInsertion(t.position,t.howMany,e)}_getTransformedByMoveOperation(t,e=!1){const i=t.sourcePosition,r=t.howMany,o=t.targetPosition;return this._getTransformedByMove(i,o,r,e)}_getTransformedBySplitOperation(t){const e=this.start._getTransformedBySplitOperation(t);let i=this.end._getTransformedBySplitOperation(t);return this.end.isEqual(t.insertionPosition)&&(i=this.end.getShiftedBy(1)),e.root!=i.root&&(i=this.end.getShiftedBy(-1)),new c(e,i)}_getTransformedByMergeOperation(t){if(this.start.isEqual(t.targetPosition)&&this.end.isEqual(t.deletionPosition))return new c(this.start);let e=this.start._getTransformedByMergeOperation(t),i=this.end._getTransformedByMergeOperation(t);return e.root!=i.root&&(i=this.end.getShiftedBy(-1)),e.isAfter(i)?(t.sourcePosition.isBefore(t.targetPosition)?(e=g._createAt(i),e.offset=0):(t.deletionPosition.isEqual(e)||(i=t.deletionPosition),e=t.targetPosition),new c(e,i)):new c(e,i)}_getTransformedByInsertion(t,e,i=!1){if(i&&this.containsPosition(t))return[new c(this.start,t),new c(t.getShiftedBy(e),this.end._getTransformedByInsertion(t,e))];{const r=new c(this.start,this.end);return r.start=r.start._getTransformedByInsertion(t,e),r.end=r.end._getTransformedByInsertion(t,e),[r]}}_getTransformedByMove(t,e,i,r=!1){if(this.isCollapsed){const p=this.start._getTransformedByMove(t,e,i);return[new c(p)]}const o=c._createFromPositionAndShift(t,i),a=e._getTransformedByDeletion(t,i);if(this.containsPosition(e)&&!r&&(o.containsPosition(this.start)||o.containsPosition(this.end))){const p=this.start._getTransformedByMove(t,e,i),y=this.end._getTransformedByMove(t,e,i);return[new c(p,y)]}let f;const h=this.getDifference(o);let d=null;const m=this.getIntersection(o);if(h.length==1?d=new c(h[0].start._getTransformedByDeletion(t,i),h[0].end._getTransformedByDeletion(t,i)):h.length==2&&(d=new c(this.start,this.end._getTransformedByDeletion(t,i))),d?f=d._getTransformedByInsertion(a,i,m!==null||r):f=[],m){const p=new c(m.start._getCombined(o.start,a),m.end._getCombined(o.start,a));f.length==2?f.splice(1,0,p):f.push(p)}return f}_getTransformedByDeletion(t,e){let i=this.start._getTransformedByDeletion(t,e),r=this.end._getTransformedByDeletion(t,e);return i==null&&r==null?null:(i==null&&(i=t),r==null&&(r=t),new c(i,r))}static _createFromPositionAndShift(t,e){const i=t,r=t.getShiftedBy(e);return e>0?new this(i,r):new this(r,i)}static _createIn(t){return new this(g._createAt(t,0),g._createAt(t,t.maxOffset))}static _createOn(t){return this._createFromPositionAndShift(g._createBefore(t),t.offsetSize)}static _createFromRanges(t){if(t.length===0)throw new u("range-create-from-ranges-empty-array",null);if(t.length==1)return t[0].clone();const e=t[0];t.sort((o,a)=>o.start.isAfter(a.start)?1:-1);const i=t.indexOf(e),r=new this(e.start,e.end);for(let o=i-1;o>=0&&t[o].end.isEqual(r.start);o--)r.start=g._createAt(t[o].start);for(let o=i+1;o<t.length&&t[o].start.isEqual(r.end);o++)r.end=g._createAt(t[o].end);return r}static fromJSON(t,e){return new this(g.fromJSON(t.start,e),g.fromJSON(t.end,e))}}c.prototype.is=function(s){return s==="range"||s==="model:range"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class rt extends z{constructor(t){super();l(this,"parent",null);l(this,"_attrs");l(this,"_index",null);l(this,"_startOffset",null);this._attrs=yt(t)}get document(){return null}get index(){return this._index}get startOffset(){return this._startOffset}get offsetSize(){return 1}get endOffset(){return this.startOffset===null?null:this.startOffset+this.offsetSize}get nextSibling(){const t=this.index;return t!==null&&this.parent.getChild(t+1)||null}get previousSibling(){const t=this.index;return t!==null&&this.parent.getChild(t-1)||null}get root(){let t=this;for(;t.parent;)t=t.parent;return t}isAttached(){return this.parent===null?!1:this.root.isAttached()}getPath(){const t=[];let e=this;for(;e.parent;)t.unshift(e.startOffset),e=e.parent;return t}getAncestors(t={}){const e=[];let i=t.includeSelf?this:this.parent;for(;i;)e[t.parentFirst?"push":"unshift"](i),i=i.parent;return e}getCommonAncestor(t,e={}){const i=this.getAncestors(e),r=t.getAncestors(e);let o=0;for(;i[o]==r[o]&&i[o];)o++;return o===0?null:i[o-1]}isBefore(t){if(this==t||this.root!==t.root)return!1;const e=this.getPath(),i=t.getPath(),r=N(e,i);switch(r){case"prefix":return!0;case"extension":return!1;default:return e[r]<i[r]}}isAfter(t){return this==t||this.root!==t.root?!1:!this.isBefore(t)}hasAttribute(t){return this._attrs.has(t)}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const t={};return this._attrs.size&&(t.attributes=Array.from(this._attrs).reduce((e,i)=>(e[i[0]]=i[1],e),{})),t}_clone(t){return new this.constructor(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(t,e){this._attrs.set(t,e)}_setAttributesTo(t){this._attrs=yt(t)}_removeAttribute(t){return this._attrs.delete(t)}_clearAttributes(){this._attrs.clear()}}rt.prototype.is=function(s){return s==="node"||s==="model:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Tt extends E(z){constructor(...t){super();l(this,"_lastRangeBackward",!1);l(this,"_attrs",new Map);l(this,"_ranges",[]);t.length&&this.setTo(...t)}get anchor(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.end:t.start}return null}get focus(){if(this._ranges.length>0){const t=this._ranges[this._ranges.length-1];return this._lastRangeBackward?t.start:t.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(t){if(this.rangeCount!=t.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(t.anchor)||!this.focus.isEqual(t.focus))return!1;for(const e of this._ranges){let i=!1;for(const r of t._ranges)if(e.isEqual(r)){i=!0;break}if(!i)return!1}return!0}*getRanges(){for(const t of this._ranges)yield new c(t.start,t.end)}getFirstRange(){let t=null;for(const e of this._ranges)(!t||e.start.isBefore(t.start))&&(t=e);return t?new c(t.start,t.end):null}getLastRange(){let t=null;for(const e of this._ranges)(!t||e.end.isAfter(t.end))&&(t=e);return t?new c(t.start,t.end):null}getFirstPosition(){const t=this.getFirstRange();return t?t.start.clone():null}getLastPosition(){const t=this.getLastRange();return t?t.end.clone():null}setTo(...t){let[e,i,r]=t;if(typeof i=="object"&&(r=i,i=void 0),e===null)this._setRanges([]);else if(e instanceof Tt)this._setRanges(e.getRanges(),e.isBackward);else if(e&&typeof e.getRanges=="function")this._setRanges(e.getRanges(),e.isBackward);else if(e instanceof c)this._setRanges([e],!!r&&!!r.backward);else if(e instanceof g)this._setRanges([new c(e)]);else if(e instanceof rt){const o=!!r&&!!r.backward;let a;if(i=="in")a=c._createIn(e);else if(i=="on")a=c._createOn(e);else if(i!==void 0)a=new c(g._createAt(e,i));else throw new u("model-selection-setto-required-second-parameter",[this,e]);this._setRanges([a],o)}else if(q(e))this._setRanges(e,r&&!!r.backward);else throw new u("model-selection-setto-not-selectable",[this,e])}_setRanges(t,e=!1){const i=Array.from(t),r=i.some(o=>{if(!(o instanceof c))throw new u("model-selection-set-ranges-not-range",[this,t]);return this._ranges.every(a=>!a.isEqual(o))});i.length===this._ranges.length&&!r||(this._replaceAllRanges(i),this._lastRangeBackward=!!e,this.fire("change:range",{directChange:!0}))}setFocus(t,e){if(this.anchor===null)throw new u("model-selection-setfocus-no-ranges",[this,t]);const i=g._createAt(t,e);if(i.compareWith(this.focus)=="same")return;const r=this.anchor;this._ranges.length&&this._popRange(),i.compareWith(r)=="before"?(this._pushRange(new c(i,r)),this._lastRangeBackward=!0):(this._pushRange(new c(r,i)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(t){return this._attrs.get(t)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(t){return this._attrs.has(t)}removeAttribute(t){this.hasAttribute(t)&&(this._attrs.delete(t),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}setAttribute(t,e){this.getAttribute(t)!==e&&(this._attrs.set(t,e),this.fire("change:attribute",{attributeKeys:[t],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}*getSelectedBlocks(){const t=new WeakSet;for(const e of this.getRanges()){const i=Pe(e.start,t);An(i,e)&&(yield i);const r=e.getWalker();for(const a of r){const f=a.item;a.type=="elementEnd"&&bn(f,t,e)?yield f:a.type=="elementStart"&&f.is("model:element")&&f.root.document.model.schema.isBlock(f)&&r.jumpTo(g._createAt(f,"end"))}const o=Pe(e.end,t);Sn(o,e)&&(yield o)}}containsEntireContent(t=this.anchor.root){const e=g._createAt(t,0),i=g._createAt(t,"end");return e.isTouching(this.getFirstPosition())&&i.isTouching(this.getLastPosition())}_pushRange(t){this._checkRange(t),this._ranges.push(new c(t.start,t.end))}_checkRange(t){for(let e=0;e<this._ranges.length;e++)if(t.isIntersecting(this._ranges[e]))throw new u("model-selection-range-intersects",[this,t],{addedRange:t,intersectingRange:this._ranges[e]})}_replaceAllRanges(t){this._removeAllRanges();for(const e of t)this._pushRange(e)}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}Tt.prototype.is=function(s){return s==="selection"||s==="model:selection"};function ze(s,n){return n.has(s)?!1:(n.add(s),s.root.document.model.schema.isBlock(s)&&!!s.parent)}function bn(s,n,t){return ze(s,n)&&Zt(s,t)}function Pe(s,n){const e=s.parent.root.document.model.schema,i=s.parent.getAncestors({parentFirst:!0,includeSelf:!0});let r=!1;const o=i.find(a=>r?!1:(r=e.isLimit(a),!r&&ze(a,n)));return i.forEach(a=>n.add(a)),o}function Zt(s,n){const t=En(s);return t?!n.containsRange(c._createOn(t),!0):!0}function An(s,n){return s?n.isCollapsed||s.isEmpty?!0:n.start.isTouching(g._createAt(s,s.maxOffset))?!1:Zt(s,n):!1}function Sn(s,n){return s?n.isCollapsed||s.isEmpty?!0:n.end.isTouching(g._createAt(s,0))?!1:Zt(s,n):!1}function En(s){const n=s.root.document.model.schema;let t=s.parent;for(;t;){if(n.isBlock(t))return t;t=t.parent}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Rt extends E(c){constructor(n,t){super(n,t),xn.call(this)}detach(){this.stopListening()}toRange(){return new c(this.start,this.end)}static fromRange(n){return new Rt(n.start,n.end)}}Rt.prototype.is=function(s){return s==="liveRange"||s==="model:liveRange"||s=="range"||s==="model:range"};function xn(){this.listenTo(this.root.document.model,"applyOperation",(s,n)=>{const t=n[0];t.isDocumentOperation&&On.call(this,t)},{priority:"low"})}function On(s){const n=this.getTransformedByOperation(s),t=c._createFromRanges(n),e=!t.isEqual(this),i=Tn(this,s);let r=null;if(e){t.root.rootName=="$graveyard"&&(s.type=="remove"?r=s.sourcePosition:r=s.deletionPosition);const o=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",o,{deletionPosition:r})}else i&&this.fire("change:content",this.toRange(),{deletionPosition:r})}function Tn(s,n){switch(n.type){case"insert":return s.containsPosition(n.position);case"move":case"remove":case"reinsert":case"merge":return s.containsPosition(n.sourcePosition)||s.start.isEqual(n.sourcePosition)||s.containsPosition(n.targetPosition);case"split":return s.containsPosition(n.splitPosition)||s.containsPosition(n.insertionPosition)}return!1}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class b extends rt{constructor(t,e){super(e);l(this,"_data");this._data=t||""}get offsetSize(){return this.data.length}get data(){return this._data}toJSON(){const t=super.toJSON();return t.data=this.data,t}_clone(){return new b(this.data,this.getAttributes())}static fromJSON(t){return new b(t.data,t.attributes)}}b.prototype.is=function(s){return s==="$text"||s==="model:$text"||s==="text"||s==="model:text"||s==="node"||s==="model:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const wt="selection:";class Rn extends E(z){constructor(t){super();l(this,"_selection");this._selection=new Nn(t),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(t){return this._selection.containsEntireContent(t)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(t){return this._selection.getAttribute(t)}hasAttribute(t){return this._selection.hasAttribute(t)}refresh(){this._selection.updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(t){this._selection.observeMarkers(t)}_setFocus(t,e){this._selection.setFocus(t,e)}_setTo(...t){this._selection.setTo(...t)}_setAttribute(t,e){this._selection.setAttribute(t,e)}_removeAttribute(t){this._selection.removeAttribute(t)}_getStoredAttributes(){return this._selection.getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(t){this._selection.restoreGravity(t)}static _getStoreAttributeKey(t){return wt+t}static _isStoreAttributeKey(t){return t.startsWith(wt)}}Rn.prototype.is=function(s){return s==="selection"||s=="model:selection"||s=="documentSelection"||s=="model:documentSelection"};class Nn extends Tt{constructor(t){super();l(this,"markers",new Gs({idProperty:"name"}));l(this,"_model");l(this,"_document");l(this,"_attributePriority",new Map);l(this,"_selectionRestorePosition",null);l(this,"_hasChangedRange",!1);l(this,"_overriddenGravityRegister",new Set);l(this,"_observedMarkers",new Set);this._model=t.model,this._document=t,this.listenTo(this._model,"applyOperation",(e,i)=>{const r=i[0];!r.isDocumentOperation||r.type=="marker"||r.type=="rename"||r.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{this._validateSelectionRanges(this.getRanges())}),this.listenTo(this._model.markers,"update",(e,i,r,o)=>{this._updateMarker(i,o)}),this.listenTo(this._document,"change",(e,i)=>{kn(this._model,i)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let t=0;t<this._ranges.length;t++)this._ranges[t].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(...t){super.setTo(...t),this._updateAttributes(!0),this.updateMarkers()}setFocus(t,e){super.setFocus(t,e),this._updateAttributes(!0),this.updateMarkers()}setAttribute(t,e){if(this._setAttribute(t,e)){const i=[t];this.fire("change:attribute",{attributeKeys:i,directChange:!0})}}removeAttribute(t){if(this._removeAttribute(t)){const e=[t];this.fire("change:attribute",{attributeKeys:e,directChange:!0})}}overrideGravity(){const t=Ot();return this._overriddenGravityRegister.add(t),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),t}restoreGravity(t){if(!this._overriddenGravityRegister.has(t))throw new u("document-selection-gravity-wrong-restore",this,{uid:t});this._overriddenGravityRegister.delete(t),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(t){this._observedMarkers.add(t),this.updateMarkers()}_replaceAllRanges(t){this._validateSelectionRanges(t),super._replaceAllRanges(t)}_popRange(){this._ranges.pop().detach()}_pushRange(t){const e=this._prepareRange(t);e&&this._ranges.push(e)}_validateSelectionRanges(t){for(const e of t)if(!this._document._validateSelectionRange(e))throw new u("document-selection-wrong-position",this,{range:e})}_prepareRange(t){if(this._checkRange(t),t.root==this._document.graveyard)return;const e=Rt.fromRange(t);return e.on("change:range",(i,r,o)=>{if(this._hasChangedRange=!0,e.root==this._document.graveyard){this._selectionRestorePosition=o.deletionPosition;const a=this._ranges.indexOf(e);this._ranges.splice(a,1),e.detach()}}),e}updateMarkers(){if(!this._observedMarkers.size)return;const t=[];let e=!1;for(const r of this._model.markers){const o=r.name.split(":",1)[0];if(!this._observedMarkers.has(o))continue;const a=r.getRange();for(const f of this.getRanges())a.containsRange(f,!f.isCollapsed)&&t.push(r)}const i=Array.from(this.markers);for(const r of t)this.markers.has(r)||(this.markers.add(r),e=!0);for(const r of Array.from(this.markers))t.includes(r)||(this.markers.remove(r),e=!0);e&&this.fire("change:marker",{oldMarkers:i,directChange:!1})}_updateMarker(t,e){const i=t.name.split(":",1)[0];if(!this._observedMarkers.has(i))return;let r=!1;const o=Array.from(this.markers),a=this.markers.has(t);if(!e)a&&(this.markers.remove(t),r=!0);else{let f=!1;for(const h of this.getRanges())if(e.containsRange(h,!h.isCollapsed)){f=!0;break}f&&!a?(this.markers.add(t),r=!0):!f&&a&&(this.markers.remove(t),r=!0)}r&&this.fire("change:marker",{oldMarkers:o,directChange:!1})}_updateAttributes(t){const e=yt(this._getSurroundingAttributes()),i=yt(this.getAttributes());if(t)this._attributePriority=new Map,this._attrs=new Map;else for(const[o,a]of this._attributePriority)a=="low"&&(this._attrs.delete(o),this._attributePriority.delete(o));this._setAttributesTo(e);const r=[];for(const[o,a]of this.getAttributes())(!i.has(o)||i.get(o)!==a)&&r.push(o);for(const[o]of i)this.hasAttribute(o)||r.push(o);r.length>0&&this.fire("change:attribute",{attributeKeys:r,directChange:!1})}_setAttribute(t,e,i=!0){const r=i?"normal":"low";return r=="low"&&this._attributePriority.get(t)=="normal"||super.getAttribute(t)===e?!1:(this._attrs.set(t,e),this._attributePriority.set(t,r),!0)}_removeAttribute(t,e=!0){const i=e?"normal":"low";return i=="low"&&this._attributePriority.get(t)=="normal"||(this._attributePriority.set(t,i),!super.hasAttribute(t))?!1:(this._attrs.delete(t),!0)}_setAttributesTo(t){const e=new Set;for(const[i,r]of this.getAttributes())t.get(i)!==r&&this._removeAttribute(i,!1);for(const[i,r]of t)this._setAttribute(i,r,!1)&&e.add(i);return e}*getStoredAttributes(){const t=this.getFirstPosition().parent;if(this.isCollapsed&&t.isEmpty)for(const e of t.getAttributeKeys())e.startsWith(wt)&&(yield[e.substr(wt.length),t.getAttribute(e)])}_getSurroundingAttributes(){const t=this.getFirstPosition(),e=this._model.schema;if(t.root.rootName=="$graveyard")return null;let i=null;if(this.isCollapsed){const r=t.textNode?t.textNode:t.nodeBefore,o=t.textNode?t.textNode:t.nodeAfter;if(this.isGravityOverridden||(i=ht(r,e)),i||(i=ht(o,e)),!this.isGravityOverridden&&!i){let a=r;for(;a&&!i;)a=a.previousSibling,i=ht(a,e)}if(!i){let a=o;for(;a&&!i;)a=a.nextSibling,i=ht(a,e)}i||(i=this.getStoredAttributes())}else{const r=this.getFirstRange();for(const o of r){if(o.item.is("element")&&e.isObject(o.item)){i=ht(o.item,e);break}if(o.type=="text"){i=o.item.getAttributes();break}}}return i}_fixGraveyardSelection(t){const e=this._model.schema.getNearestSelectionRange(t);e&&this._pushRange(e)}}function ht(s,n){if(!s)return null;if(s instanceof Y||s instanceof b)return s.getAttributes();if(!n.isInline(s))return null;if(!n.isObject(s))return[];const t=[];for(const[e,i]of s.getAttributes())n.checkAttribute("$text",e)&&n.getAttributeProperties(e).copyFromObject!==!1&&t.push([e,i]);return t}function kn(s,n){const t=s.document.differ;for(const e of t.getChanges()){if(e.type!="insert")continue;const i=e.position.parent;e.length===i.maxOffset&&s.enqueueChange(n,o=>{const a=Array.from(i.getAttributeKeys()).filter(f=>f.startsWith(wt));for(const f of a)o.removeAttribute(f,i)})}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class pt{constructor(n){l(this,"_nodes",[]);l(this,"_offsetToNode",[]);n&&this._insertNodes(0,n)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._offsetToNode.length}getNode(n){return this._nodes[n]||null}getNodeAtOffset(n){return this._offsetToNode[n]||null}getNodeIndex(n){return n.index}getNodeStartOffset(n){return n.startOffset}indexToOffset(n){if(n==this._nodes.length)return this.maxOffset;const t=this._nodes[n];if(!t)throw new u("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(n){if(n==this._offsetToNode.length)return this._nodes.length;const t=this._offsetToNode[n];if(!t)throw new u("model-nodelist-offset-out-of-bounds",this,{offset:n,nodeList:this});return this.getNodeIndex(t)}_insertNodes(n,t){const e=[];for(const r of t){if(!(r instanceof rt))throw new u("model-nodelist-insertnodes-not-node",this);e.push(r)}let i=this.indexToOffset(n);me(this._nodes,e,n),me(this._offsetToNode,Mn(e),i);for(let r=n;r<this._nodes.length;r++)this._nodes[r]._index=r,this._nodes[r]._startOffset=i,i+=this._nodes[r].offsetSize}_removeNodes(n,t=1){if(t==0)return[];let e=this.indexToOffset(n);const i=this._nodes.splice(n,t),r=i[i.length-1],o=r.startOffset+r.offsetSize-e;this._offsetToNode.splice(e,o);for(const a of i)a._index=null,a._startOffset=null;for(let a=n;a<this._nodes.length;a++)this._nodes[a]._index=a,this._nodes[a]._startOffset=e,e+=this._nodes[a].offsetSize;return i}_removeNodesArray(n){if(n.length==0)return;for(const e of n)e._index=null,e._startOffset=null;this._nodes=this._nodes.filter(e=>e.index!==null),this._offsetToNode=this._offsetToNode.filter(e=>e.index!==null);let t=0;for(let e=0;e<this._nodes.length;e++)this._nodes[e]._index=e,this._nodes[e]._startOffset=t,t+=this._nodes[e].offsetSize}toJSON(){return this._nodes.map(n=>n.toJSON())}}function Mn(s){const n=[];let t=0;for(const e of s)for(let i=0;i<e.offsetSize;i++)n[t++]=e;return n}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class D extends rt{constructor(t,e,i){super(e);l(this,"name");l(this,"_children",new pt);this.name=t,i&&this._insertChild(0,i)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}getChild(t){return this._children.getNode(t)}getChildAtOffset(t){return this._children.getNodeAtOffset(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}offsetToIndex(t){return this._children.offsetToIndex(t)}getNodeByPath(t){let e=this;for(const i of t)e=e.getChildAtOffset(i);return e}findAncestor(t,e={}){let i=e.includeSelf?this:this.parent;for(;i;){if(i.name===t)return i;i=i.parent}return null}toJSON(){const t=super.toJSON();if(t.name=this.name,this._children.length>0){t.children=[];for(const e of this._children)t.children.push(e.toJSON())}return t}_clone(t=!1){const e=t?Cn(this._children):void 0;return new D(this.name,this.getAttributes(),e)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,e){const i=Bn(e);for(const r of i)r.parent!==null&&r._remove(),r.parent=this;this._children._insertNodes(t,i)}_removeChildren(t,e=1){const i=this._children._removeNodes(t,e);for(const r of i)r.parent=null;return i}_removeChildrenArray(t){this._children._removeNodesArray(t);for(const e of t)e.parent=null}static fromJSON(t){let e;if(t.children){e=[];for(const i of t.children)i.name?e.push(D.fromJSON(i)):e.push(b.fromJSON(i))}return new D(t.name,t.attributes,e)}}D.prototype.is=function(s,n){return n?n===this.name&&(s==="element"||s==="model:element"):s==="element"||s==="model:element"||s==="node"||s==="model:node"};function Bn(s){if(typeof s=="string")return[new b(s)];q(s)||(s=[s]);const n=[];for(const t of s)typeof t=="string"?n.push(new b(t)):t instanceof Y?n.push(new b(t.data,t.getAttributes())):n.push(t);return n}function Cn(s){const n=[];for(const t of s)n.push(t._clone(!0));return n}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class B{constructor(n){l(this,"baseVersion");l(this,"isDocumentOperation");l(this,"batch");this.baseVersion=n,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const n=Object.assign({},this);return n.__className=this.constructor.className,delete n.batch,delete n.isDocumentOperation,n}static get className(){return"Operation"}static fromJSON(n,t){return new this(n.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */function Qt(s,n){const t=Ue(n),e=t.reduce((o,a)=>o+a.offsetSize,0),i=s.parent;bt(s);const r=s.index;return i._insertChild(r,t),vt(i,r+t.length),vt(i,r),new c(s,s.getShiftedBy(e))}function Fn(s){if(!s.isFlat)throw new u("operation-utils-remove-range-not-flat",this);const n=s.start.parent;bt(s.start),bt(s.end);const t=n._removeChildren(s.start.index,s.end.index-s.start.index);return vt(n,s.start.index),t}function Pt(s,n){if(!s.isFlat)throw new u("operation-utils-move-range-not-flat",this);const t=Fn(s);return n=n._getTransformedByDeletion(s.start,s.end.offset-s.start.offset),Qt(n,t)}function In(s,n,t){bt(s.start),bt(s.end);for(const e of s.getItems({shallow:!0})){const i=e.is("$textProxy")?e.textNode:e;t!==null?i._setAttribute(n,t):i._removeAttribute(n),vt(i.parent,i.index)}vt(s.end.parent,s.end.index)}function Ue(s){const n=[];function t(e){if(typeof e=="string")n.push(new b(e));else if(e instanceof Y)n.push(new b(e.data,e.getAttributes()));else if(e instanceof rt)n.push(e);else if(q(e))for(const i of e)t(i)}t(s);for(let e=1;e<n.length;e++){const i=n[e],r=n[e-1];i instanceof b&&r instanceof b&&Ke(i,r)&&(n.splice(e-1,2,new b(r.data+i.data,r.getAttributes())),e--)}return n}function vt(s,n){const t=s.getChild(n-1),e=s.getChild(n);if(t&&e&&t.is("$text")&&e.is("$text")&&Ke(t,e)){const i=new b(t.data+e.data,t.getAttributes());s._removeChildren(n-1,2),s._insertChild(n-1,i)}}function bt(s){const n=s.textNode,t=s.parent;if(n){const e=s.offset-n.startOffset,i=n.index;t._removeChildren(i,1);const r=new b(n.data.substr(0,e),n.getAttributes()),o=new b(n.data.substr(e),n.getAttributes());t._insertChild(i,[r,o])}}function Ke(s,n){const t=s.getAttributes(),e=n.getAttributes();for(const i of t){if(i[1]!==n.getAttribute(i[0]))return!1;e.next()}return e.next().done}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class P extends B{constructor(t,e,i,r){super(r);l(this,"sourcePosition");l(this,"howMany");l(this,"targetPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toNext",this.howMany=e,this.targetPosition=i.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}get affectedSelectable(){return[c._createFromPositionAndShift(this.sourcePosition,this.howMany),c._createFromPositionAndShift(this.targetPosition,0)]}clone(){return new P(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const t=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new P(this.getMovedRangeStart(),this.howMany,t,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,e=this.targetPosition.parent,i=this.sourcePosition.offset,r=this.targetPosition.offset;if(i+this.howMany>t.maxOffset)throw new u("move-operation-nodes-do-not-exist",this);if(t===e&&i<r&&r<i+this.howMany)throw new u("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&N(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const o=this.sourcePosition.path.length-1;if(this.targetPosition.path[o]>=i&&this.targetPosition.path[o]<i+this.howMany)throw new u("move-operation-node-into-itself",this)}}_execute(){Pt(c._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=this.sourcePosition.toJSON(),t.targetPosition=this.targetPosition.toJSON(),t}static get className(){return"MoveOperation"}static fromJSON(t,e){const i=g.fromJSON(t.sourcePosition,e),r=g.fromJSON(t.targetPosition,e);return new this(i,t.howMany,r,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class O extends B{constructor(t,e,i){super(i);l(this,"position");l(this,"nodes");l(this,"shouldReceiveAttributes");this.position=t.clone(),this.position.stickiness="toNone",this.nodes=new pt(Ue(e)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}get affectedSelectable(){return this.position.clone()}clone(){const t=new pt([...this.nodes].map(i=>i._clone(!0))),e=new O(this.position,t,this.baseVersion);return e.shouldReceiveAttributes=this.shouldReceiveAttributes,e}getReversed(){const t=this.position.root.document.graveyard,e=new g(t,[0]);return new P(this.position,this.nodes.maxOffset,e,this.baseVersion+1)}_validate(){const t=this.position.parent;if(!t||t.maxOffset<this.position.offset)throw new u("insert-operation-position-invalid",this)}_execute(){const t=this.nodes;this.nodes=new pt([...t].map(e=>e._clone(!0))),Qt(this.position,t)}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t.nodes=this.nodes.toJSON(),t}static get className(){return"InsertOperation"}static fromJSON(t,e){const i=[];for(const o of t.nodes)o.name?i.push(D.fromJSON(o)):i.push(b.fromJSON(o));const r=new O(g.fromJSON(t.position,e),i,t.baseVersion);return r.shouldReceiveAttributes=t.shouldReceiveAttributes,r}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class v extends B{constructor(t,e,i,r,o){super(o);l(this,"splitPosition");l(this,"howMany");l(this,"insertionPosition");l(this,"graveyardPosition");this.splitPosition=t.clone(),this.splitPosition.stickiness="toNext",this.howMany=e,this.insertionPosition=i,this.graveyardPosition=r?r.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const t=this.insertionPosition.path.slice();return t.push(0),new g(this.insertionPosition.root,t)}get movedRange(){const t=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new c(this.splitPosition,t)}get affectedSelectable(){const t=[c._createFromPositionAndShift(this.splitPosition,0),c._createFromPositionAndShift(this.insertionPosition,0)];return this.graveyardPosition&&t.push(c._createFromPositionAndShift(this.graveyardPosition,0)),t}clone(){return new v(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.splitPosition.root.document.graveyard,e=new g(t,[0]);return new R(this.moveTargetPosition,this.howMany,this.splitPosition,e,this.baseVersion+1)}_validate(){const t=this.splitPosition.parent,e=this.splitPosition.offset;if(!t||t.maxOffset<e)throw new u("split-operation-position-invalid",this);if(t.parent){if(this.howMany!=t.maxOffset-this.splitPosition.offset)throw new u("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new u("split-operation-graveyard-position-invalid",this)}else throw new u("split-operation-split-in-root",this)}_execute(){const t=this.splitPosition.parent;if(this.graveyardPosition)Pt(c._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const i=t._clone();Qt(this.insertionPosition,i)}const e=new c(g._createAt(t,this.splitPosition.offset),g._createAt(t,t.maxOffset));Pt(e,this.moveTargetPosition)}toJSON(){const t=super.toJSON();return t.splitPosition=this.splitPosition.toJSON(),t.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(t.graveyardPosition=this.graveyardPosition.toJSON()),t}static get className(){return"SplitOperation"}static getInsertionPosition(t){const e=t.path.slice(0,-1);return e[e.length-1]++,new g(t.root,e,"toPrevious")}static fromJSON(t,e){const i=g.fromJSON(t.splitPosition,e),r=g.fromJSON(t.insertionPosition,e),o=t.graveyardPosition?g.fromJSON(t.graveyardPosition,e):null;return new this(i,t.howMany,r,o,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class R extends B{constructor(t,e,i,r,o){super(o);l(this,"sourcePosition");l(this,"howMany");l(this,"targetPosition");l(this,"graveyardPosition");this.sourcePosition=t.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=e,this.targetPosition=i.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=r.clone()}get type(){return"merge"}get deletionPosition(){return new g(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const t=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new c(this.sourcePosition,t)}get affectedSelectable(){const t=this.sourcePosition.parent;return[c._createOn(t),c._createFromPositionAndShift(this.targetPosition,0),c._createFromPositionAndShift(this.graveyardPosition,0)]}clone(){return new R(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const t=this.targetPosition._getTransformedByMergeOperation(this),e=this.sourcePosition.path.slice(0,-1),i=new g(this.sourcePosition.root,e)._getTransformedByMergeOperation(this);return new v(t,this.howMany,i,this.graveyardPosition,this.baseVersion+1)}_validate(){const t=this.sourcePosition.parent,e=this.targetPosition.parent;if(t.parent)if(e.parent){if(this.howMany!=t.maxOffset)throw new u("merge-operation-how-many-invalid",this)}else throw new u("merge-operation-target-position-invalid",this);else throw new u("merge-operation-source-position-invalid",this)}_execute(){const t=this.sourcePosition.parent,e=c._createIn(t);Pt(e,this.targetPosition),Pt(c._createOn(t),this.graveyardPosition)}toJSON(){const t=super.toJSON();return t.sourcePosition=t.sourcePosition.toJSON(),t.targetPosition=t.targetPosition.toJSON(),t.graveyardPosition=t.graveyardPosition.toJSON(),t}static get className(){return"MergeOperation"}static fromJSON(t,e){const i=g.fromJSON(t.sourcePosition,e),r=g.fromJSON(t.targetPosition,e),o=g.fromJSON(t.graveyardPosition,e);return new this(i,t.howMany,r,o,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class M extends B{constructor(t,e,i,r,o,a){super(a);l(this,"name");l(this,"oldRange");l(this,"newRange");l(this,"affectsData");l(this,"_markers");this.name=t,this.oldRange=e?e.clone():null,this.newRange=i?i.clone():null,this.affectsData=o,this._markers=r}get type(){return"marker"}get affectedSelectable(){const t=[];return this.oldRange&&t.push(this.oldRange.clone()),this.newRange&&(this.oldRange?t.push(...this.newRange.getDifference(this.oldRange)):t.push(this.newRange.clone())),t}clone(){return new M(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new M(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){this.newRange?this._markers._set(this.name,this.newRange,!0,this.affectsData):this._markers._remove(this.name)}toJSON(){const t=super.toJSON();return this.oldRange&&(t.oldRange=this.oldRange.toJSON()),this.newRange&&(t.newRange=this.newRange.toJSON()),delete t._markers,t}static get className(){return"MarkerOperation"}static fromJSON(t,e){return new M(t.name,t.oldRange?c.fromJSON(t.oldRange,e):null,t.newRange?c.fromJSON(t.newRange,e):null,e.model.markers,t.affectsData,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class S extends B{constructor(t,e,i,r,o){super(o);l(this,"range");l(this,"key");l(this,"oldValue");l(this,"newValue");this.range=t.clone(),this.key=e,this.oldValue=i===void 0?null:i,this.newValue=r===void 0?null:r}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}get affectedSelectable(){return this.range.clone()}clone(){return new S(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new S(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const t=super.toJSON();return t.range=this.range.toJSON(),t}_validate(){if(!this.range.isFlat)throw new u("attribute-operation-range-not-flat",this);for(const t of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!le(t.getAttribute(this.key),this.oldValue))throw new u("attribute-operation-wrong-old-value",this,{item:t,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&t.hasAttribute(this.key))throw new u("attribute-operation-attribute-exists",this,{node:t,key:this.key})}}_execute(){le(this.oldValue,this.newValue)||In(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(t,e){return new S(c.fromJSON(t.range,e),t.key,t.oldValue,t.newValue,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class x extends B{get type(){return"noop"}get affectedSelectable(){return null}clone(){return new x(this.baseVersion)}getReversed(){return new x(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class k extends B{constructor(t,e,i,r){super(r);l(this,"position");l(this,"oldName");l(this,"newName");this.position=t,this.position.stickiness="toNext",this.oldName=e,this.newName=i}get type(){return"rename"}get affectedSelectable(){return this.position.nodeAfter}clone(){return new k(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new k(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const t=this.position.nodeAfter;if(t instanceof D){if(t.name!==this.oldName)throw new u("rename-operation-wrong-name",this)}else throw new u("rename-operation-wrong-position",this)}_execute(){const t=this.position.nodeAfter;t.name=this.newName}toJSON(){const t=super.toJSON();return t.position=this.position.toJSON(),t}static get className(){return"RenameOperation"}static fromJSON(t,e){return new k(g.fromJSON(t.position,e),t.oldName,t.newName,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class $ extends B{constructor(t,e,i,r,o){super(o);l(this,"root");l(this,"key");l(this,"oldValue");l(this,"newValue");this.root=t,this.key=e,this.oldValue=i===void 0?null:i,this.newValue=r===void 0?null:r}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}get affectedSelectable(){return this.root}clone(){return new $(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new $(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new u("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new u("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new u("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const t=super.toJSON();return t.root=this.root.toJSON(),t}static get className(){return"RootAttributeOperation"}static fromJSON(t,e){if(!e.getRoot(t.root))throw new u("rootattribute-operation-fromjson-no-root",this,{rootName:t.root});return new $(e.getRoot(t.root),t.key,t.oldValue,t.newValue,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class W extends B{constructor(t,e,i,r,o){super(o);l(this,"rootName");l(this,"elementName");l(this,"isAdd");l(this,"_document");if(this.rootName=t,this.elementName=e,this.isAdd=i,this._document=r,!this._document.getRoot(this.rootName)){const a=this._document.createRoot(this.elementName,this.rootName);a._isAttached=!1}}get type(){return this.isAdd?"addRoot":"detachRoot"}get affectedSelectable(){return this._document.getRoot(this.rootName)}clone(){return new W(this.rootName,this.elementName,this.isAdd,this._document,this.baseVersion)}getReversed(){return new W(this.rootName,this.elementName,!this.isAdd,this._document,this.baseVersion+1)}_execute(){this._document.getRoot(this.rootName)._isAttached=this.isAdd}toJSON(){const t=super.toJSON();return delete t._document,t}static get className(){return"RootOperation"}static fromJSON(t,e){return new W(t.rootName,t.elementName,t.isAdd,e,t.baseVersion)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const C={};C[S.className]=S;C[O.className]=O;C[M.className]=M;C[P.className]=P;C[x.className]=x;C[B.className]=B;C[k.className]=k;C[$.className]=$;C[W.className]=W;C[v.className]=v;C[R.className]=R;/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */const ve=new Map;function _(s,n,t){let e=ve.get(s);e||(e=new Map,ve.set(s,e)),e.set(n,t)}_(S,S,(s,n,t)=>{if(s.key===n.key&&s.range.start.hasSameParentAs(n.range.start)){const e=s.range.getDifference(n.range).map(r=>new S(r,s.key,s.oldValue,s.newValue,0)),i=s.range.getIntersection(n.range);return i&&t.aIsStrong&&e.push(new S(i,n.key,n.newValue,s.newValue,0)),e.length==0?[new x(0)]:e}else return[s]});_(S,O,(s,n)=>{if(s.range.start.hasSameParentAs(n.position)&&s.range.containsPosition(n.position)){const e=s.range._getTransformedByInsertion(n.position,n.howMany,!n.shouldReceiveAttributes).map(i=>new S(i,s.key,s.oldValue,s.newValue,s.baseVersion));if(n.shouldReceiveAttributes){const i=Ge(n,s.key,s.oldValue);i&&e.unshift(i)}return e}return s.range=s.range._getTransformedByInsertion(n.position,n.howMany,!1)[0],[s]});function Ge(s,n,t){const i=s.nodes.getNode(0).getAttribute(n);if(i==t)return null;const r=new c(s.position,s.position.getShiftedBy(s.howMany));return new S(r,n,i,t,0)}_(S,R,(s,n)=>{const t=[];s.range.start.hasSameParentAs(n.deletionPosition)&&(s.range.containsPosition(n.deletionPosition)||s.range.start.isEqual(n.deletionPosition))&&t.push(c._createFromPositionAndShift(n.graveyardPosition,1));const e=s.range._getTransformedByMergeOperation(n);return e.isCollapsed||t.push(e),t.map(i=>new S(i,s.key,s.oldValue,s.newValue,s.baseVersion))});_(S,P,(s,n)=>Ln(s.range,n).map(e=>new S(e,s.key,s.oldValue,s.newValue,s.baseVersion)));function Ln(s,n){const t=c._createFromPositionAndShift(n.sourcePosition,n.howMany);let e=null,i=[];t.containsRange(s,!0)?e=s:s.start.hasSameParentAs(t.start)?(i=s.getDifference(t),e=s.getIntersection(t)):i=[s];const r=[];for(let o of i){o=o._getTransformedByDeletion(n.sourcePosition,n.howMany);const a=n.getMovedRangeStart(),f=o.start.hasSameParentAs(a),h=o._getTransformedByInsertion(a,n.howMany,f);r.push(...h)}return e&&r.push(e._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany,!1)[0]),r}_(S,v,(s,n)=>{if(s.range.end.isEqual(n.insertionPosition))return n.graveyardPosition||s.range.end.offset++,[s];if(s.range.start.hasSameParentAs(n.splitPosition)&&s.range.containsPosition(n.splitPosition)){const t=s.clone();return t.range=new c(n.moveTargetPosition.clone(),s.range.end._getCombined(n.splitPosition,n.moveTargetPosition)),s.range.end=n.splitPosition.clone(),s.range.end.stickiness="toPrevious",[s,t]}return s.range=s.range._getTransformedBySplitOperation(n),[s]});_(O,S,(s,n)=>{const t=[s];if(s.shouldReceiveAttributes&&s.position.hasSameParentAs(n.range.start)&&n.range.containsPosition(s.position)){const e=Ge(s,n.key,n.newValue);e&&t.push(e)}return t});_(O,O,(s,n,t)=>s.position.isEqual(n.position)&&t.aIsStrong?[s]:(s.position=s.position._getTransformedByInsertOperation(n),[s]));_(O,P,(s,n)=>(s.position=s.position._getTransformedByMoveOperation(n),[s]));_(O,v,(s,n)=>(s.position=s.position._getTransformedBySplitOperation(n),[s]));_(O,R,(s,n)=>(s.position=s.position._getTransformedByMergeOperation(n),[s]));_(M,O,(s,n)=>(s.oldRange&&(s.oldRange=s.oldRange._getTransformedByInsertOperation(n)[0]),s.newRange&&(s.newRange=s.newRange._getTransformedByInsertOperation(n)[0]),[s]));_(M,M,(s,n,t)=>{if(s.name==n.name)if(t.aIsStrong)s.oldRange=n.newRange?n.newRange.clone():null;else return[new x(0)];return[s]});_(M,R,(s,n)=>(s.oldRange&&(s.oldRange=s.oldRange._getTransformedByMergeOperation(n)),s.newRange&&(s.newRange=s.newRange._getTransformedByMergeOperation(n)),[s]));_(M,P,(s,n)=>{const t=[s];if(s.oldRange&&(s.oldRange=c._createFromRanges(s.oldRange._getTransformedByMoveOperation(n))),s.newRange){const e=s.newRange._getTransformedByMoveOperation(n);s.newRange=e[0];for(let i=1;i<e.length;i++){const r=s.clone();r.oldRange=null,r.newRange=e[i],r.baseVersion=-1,t.push(r)}}return t});_(M,v,(s,n,t)=>{if(s.oldRange&&(s.oldRange=s.oldRange._getTransformedBySplitOperation(n)),s.newRange){if(t.abRelation){const e=s.newRange._getTransformedBySplitOperation(n);return s.newRange.start.isEqual(n.splitPosition)?t.abRelation.wasStartBeforeMergedElement?s.newRange.start=g._createAt(n.insertionPosition):t.abRelation.wasInLeftElement?s.newRange.start=g._createAt(s.newRange.start):s.newRange.start=g._createAt(n.moveTargetPosition):s.newRange.start=e.start,s.newRange.end.isEqual(n.splitPosition)?s.newRange.end.isEqual(n.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?s.newRange.end=g._createAt(n.insertionPosition):t.abRelation.wasInRightElement?s.newRange.end=g._createAt(n.moveTargetPosition):s.newRange.end=g._createAt(s.newRange.end):s.newRange.end=e.end,[s]}s.newRange=s.newRange._getTransformedBySplitOperation(n)}return[s]});_(R,O,(s,n)=>(s.sourcePosition.hasSameParentAs(n.position)&&(s.howMany+=n.howMany),s.sourcePosition=s.sourcePosition._getTransformedByInsertOperation(n),s.targetPosition=s.targetPosition._getTransformedByInsertOperation(n),[s]));_(R,R,(s,n,t)=>{if(s.sourcePosition.isEqual(n.sourcePosition)&&s.targetPosition.isEqual(n.targetPosition))if(t.bWasUndone){const e=n.graveyardPosition.path.slice();return e.push(0),s.sourcePosition=new g(n.graveyardPosition.root,e),s.howMany=0,[s]}else return[new x(0)];if(s.sourcePosition.isEqual(n.sourcePosition)&&!s.targetPosition.isEqual(n.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const e=s.targetPosition.root.rootName=="$graveyard",i=n.targetPosition.root.rootName=="$graveyard";if(i&&!e||!(e&&!i)&&t.aIsStrong){const f=n.targetPosition._getTransformedByMergeOperation(n),h=s.targetPosition._getTransformedByMergeOperation(n);return[new P(f,s.howMany,h,0)]}else return[new x(0)]}return s.sourcePosition.hasSameParentAs(n.targetPosition)&&(s.howMany+=n.howMany),s.sourcePosition=s.sourcePosition._getTransformedByMergeOperation(n),s.targetPosition=s.targetPosition._getTransformedByMergeOperation(n),(!s.graveyardPosition.isEqual(n.graveyardPosition)||!t.aIsStrong)&&(s.graveyardPosition=s.graveyardPosition._getTransformedByMergeOperation(n)),[s]});_(R,P,(s,n,t)=>{const e=c._createFromPositionAndShift(n.sourcePosition,n.howMany);return n.type=="remove"&&!t.bWasUndone&&s.deletionPosition.hasSameParentAs(n.sourcePosition)&&e.containsPosition(s.sourcePosition)?[new x(0)]:(n.sourcePosition.getShiftedBy(n.howMany).isEqual(s.sourcePosition)?s.sourcePosition.stickiness="toNone":n.targetPosition.isEqual(s.sourcePosition)&&t.abRelation=="mergeSourceAffected"?s.sourcePosition.stickiness="toNext":n.sourcePosition.isEqual(s.targetPosition)?(s.targetPosition.stickiness="toNone",s.howMany-=n.howMany):n.targetPosition.isEqual(s.targetPosition)&&t.abRelation=="mergeTargetWasBefore"?(s.targetPosition.stickiness="toPrevious",s.howMany+=n.howMany):(s.sourcePosition.hasSameParentAs(n.targetPosition)&&(s.howMany+=n.howMany),s.sourcePosition.hasSameParentAs(n.sourcePosition)&&(s.howMany-=n.howMany)),s.sourcePosition=s.sourcePosition._getTransformedByMoveOperation(n),s.targetPosition=s.targetPosition._getTransformedByMoveOperation(n),s.sourcePosition.stickiness="toPrevious",s.targetPosition.stickiness="toNext",s.graveyardPosition.isEqual(n.targetPosition)||(s.graveyardPosition=s.graveyardPosition._getTransformedByMoveOperation(n)),[s])});_(R,v,(s,n,t)=>{if(n.graveyardPosition&&(s.graveyardPosition=s.graveyardPosition._getTransformedByDeletion(n.graveyardPosition,1),s.deletionPosition.isEqual(n.graveyardPosition)&&(s.howMany=n.howMany)),s.targetPosition.isEqual(n.splitPosition)&&(n.graveyardPosition&&s.deletionPosition.isEqual(n.graveyardPosition)||t.abRelation=="mergeTargetNotMoved"))return s.sourcePosition=s.sourcePosition._getTransformedBySplitOperation(n),[s];if(s.sourcePosition.isEqual(n.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return s.howMany=0,s.targetPosition=s.targetPosition._getTransformedBySplitOperation(n),[s];if(t.abRelation=="mergeSameElement"||s.sourcePosition.offset>0)return s.sourcePosition=n.moveTargetPosition.clone(),s.targetPosition=s.targetPosition._getTransformedBySplitOperation(n),[s]}return s.sourcePosition.hasSameParentAs(n.splitPosition)&&(s.howMany=n.splitPosition.offset),s.sourcePosition=s.sourcePosition._getTransformedBySplitOperation(n),s.targetPosition=s.targetPosition._getTransformedBySplitOperation(n),[s]});_(P,O,(s,n)=>{const e=c._createFromPositionAndShift(s.sourcePosition,s.howMany)._getTransformedByInsertOperation(n,!1)[0];return s.sourcePosition=e.start,s.howMany=e.end.offset-e.start.offset,s.targetPosition.isEqual(n.position)||(s.targetPosition=s.targetPosition._getTransformedByInsertOperation(n)),[s]});_(P,P,(s,n,t)=>{const e=c._createFromPositionAndShift(s.sourcePosition,s.howMany),i=c._createFromPositionAndShift(n.sourcePosition,n.howMany);let r=t.aIsStrong,o=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?o=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(o=!1);let a;if(s.targetPosition.isEqual(n.targetPosition)&&o?a=s.targetPosition._getTransformedByDeletion(n.sourcePosition,n.howMany):a=s.targetPosition._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany),be(s,n)&&be(n,s))return[n.getReversed()];if(e.containsPosition(n.targetPosition)&&e.containsRange(i,!0))return e.start=e.start._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany),e.end=e.end._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany),st([e],a);if(i.containsPosition(s.targetPosition)&&i.containsRange(e,!0))return e.start=e.start._getCombined(n.sourcePosition,n.getMovedRangeStart()),e.end=e.end._getCombined(n.sourcePosition,n.getMovedRangeStart()),st([e],a);const d=N(s.sourcePosition.getParentPath(),n.sourcePosition.getParentPath());if(d=="prefix"||d=="extension")return e.start=e.start._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany),e.end=e.end._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany),st([e],a);s.type=="remove"&&n.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?r=!0:s.type!="remove"&&n.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(r=!1);const m=[],p=e.getDifference(i);for(const A of p){A.start=A.start._getTransformedByDeletion(n.sourcePosition,n.howMany),A.end=A.end._getTransformedByDeletion(n.sourcePosition,n.howMany);const At=N(A.start.getParentPath(),n.getMovedRangeStart().getParentPath())=="same",ot=A._getTransformedByInsertion(n.getMovedRangeStart(),n.howMany,At);m.push(...ot)}const y=e.getIntersection(i);return y!==null&&r&&(y.start=y.start._getCombined(n.sourcePosition,n.getMovedRangeStart()),y.end=y.end._getCombined(n.sourcePosition,n.getMovedRangeStart()),m.length===0?m.push(y):m.length==1?i.start.isBefore(e.start)||i.start.isEqual(e.start)?m.unshift(y):m.push(y):m.splice(1,0,y)),m.length===0?[new x(s.baseVersion)]:st(m,a)});_(P,v,(s,n,t)=>{let e=s.targetPosition.clone();(!s.targetPosition.isEqual(n.insertionPosition)||!n.graveyardPosition||t.abRelation=="moveTargetAfter")&&(e=s.targetPosition._getTransformedBySplitOperation(n));const i=c._createFromPositionAndShift(s.sourcePosition,s.howMany);if(i.end.isEqual(n.insertionPosition))return n.graveyardPosition||s.howMany++,s.targetPosition=e,[s];if(i.start.hasSameParentAs(n.splitPosition)&&i.containsPosition(n.splitPosition)){let a=new c(n.splitPosition,i.end);a=a._getTransformedBySplitOperation(n);const f=[new c(i.start,n.splitPosition),a];return st(f,e)}s.targetPosition.isEqual(n.splitPosition)&&t.abRelation=="insertAtSource"&&(e=n.moveTargetPosition),s.targetPosition.isEqual(n.insertionPosition)&&t.abRelation=="insertBetween"&&(e=s.targetPosition);const o=[i._getTransformedBySplitOperation(n)];if(n.graveyardPosition){const a=i.start.isEqual(n.graveyardPosition)||i.containsPosition(n.graveyardPosition);s.howMany>1&&a&&!t.aWasUndone&&o.push(c._createFromPositionAndShift(n.insertionPosition,1))}return st(o,e)});_(P,R,(s,n,t)=>{const e=c._createFromPositionAndShift(s.sourcePosition,s.howMany);if(n.deletionPosition.hasSameParentAs(s.sourcePosition)&&e.containsPosition(n.sourcePosition)){if(s.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const o=[];let a=n.graveyardPosition.clone(),f=n.targetPosition._getTransformedByMergeOperation(n);const h=s.targetPosition.getTransformedByOperation(n);s.howMany>1&&(o.push(new P(s.sourcePosition,s.howMany-1,h,0)),a=a._getTransformedByMove(s.sourcePosition,h,s.howMany-1),f=f._getTransformedByMove(s.sourcePosition,h,s.howMany-1));const d=n.deletionPosition._getCombined(s.sourcePosition,h),m=new P(a,1,d,0),p=m.getMovedRangeStart().path.slice();p.push(0);const y=new g(m.targetPosition.root,p);f=f._getTransformedByMove(a,d,1);const A=new P(f,n.howMany,y,0);return o.push(m),o.push(A),o}}else if(s.howMany==1)return t.bWasUndone?(s.sourcePosition=n.graveyardPosition.clone(),s.targetPosition=s.targetPosition._getTransformedByMergeOperation(n),[s]):[new x(0)]}const r=c._createFromPositionAndShift(s.sourcePosition,s.howMany)._getTransformedByMergeOperation(n);return s.sourcePosition=r.start,s.howMany=r.end.offset-r.start.offset,s.targetPosition=s.targetPosition._getTransformedByMergeOperation(n),[s]});_(k,O,(s,n)=>(s.position=s.position._getTransformedByInsertOperation(n),[s]));_(k,R,(s,n)=>s.position.isEqual(n.deletionPosition)?(s.position=n.graveyardPosition.clone(),s.position.stickiness="toNext",[s]):(s.position=s.position._getTransformedByMergeOperation(n),[s]));_(k,P,(s,n)=>(s.position=s.position._getTransformedByMoveOperation(n),[s]));_(k,k,(s,n,t)=>{if(s.position.isEqual(n.position))if(t.aIsStrong)s.oldName=n.newName;else return[new x(0)];return[s]});_(k,v,(s,n)=>{const t=s.position.path,e=n.splitPosition.getParentPath();if(N(t,e)=="same"&&!n.graveyardPosition){const i=new k(s.position.getShiftedBy(1),s.oldName,s.newName,0);return[s,i]}return s.position=s.position._getTransformedBySplitOperation(n),[s]});_($,$,(s,n,t)=>{if(s.root===n.root&&s.key===n.key){if(!t.aIsStrong||s.newValue===n.newValue)return[new x(0)];s.oldValue=n.newValue}return[s]});_(W,W,(s,n)=>s.rootName===n.rootName&&s.isAdd===n.isAdd?[new x(0)]:[s]);_(v,O,(s,n)=>(s.splitPosition.hasSameParentAs(n.position)&&s.splitPosition.offset<n.position.offset&&(s.howMany+=n.howMany),s.splitPosition=s.splitPosition._getTransformedByInsertOperation(n),s.insertionPosition=s.insertionPosition._getTransformedByInsertOperation(n),[s]));_(v,R,(s,n,t)=>{if(!s.graveyardPosition&&!t.bWasUndone&&s.splitPosition.hasSameParentAs(n.sourcePosition)){const e=n.graveyardPosition.path.slice();e.push(0);const i=new g(n.graveyardPosition.root,e),r=v.getInsertionPosition(new g(n.graveyardPosition.root,e)),o=new v(i,0,r,null,0);return s.splitPosition=s.splitPosition._getTransformedByMergeOperation(n),s.insertionPosition=v.getInsertionPosition(s.splitPosition),s.graveyardPosition=o.insertionPosition.clone(),s.graveyardPosition.stickiness="toNext",[o,s]}return s.splitPosition.hasSameParentAs(n.deletionPosition)&&!s.splitPosition.isAfter(n.deletionPosition)&&s.howMany--,s.splitPosition.hasSameParentAs(n.targetPosition)&&(s.howMany+=n.howMany),s.splitPosition=s.splitPosition._getTransformedByMergeOperation(n),s.insertionPosition=v.getInsertionPosition(s.splitPosition),s.graveyardPosition&&(s.graveyardPosition=s.graveyardPosition._getTransformedByMergeOperation(n)),[s]});_(v,P,(s,n,t)=>{const e=c._createFromPositionAndShift(n.sourcePosition,n.howMany);if(s.graveyardPosition){const r=e.start.isEqual(s.graveyardPosition)||e.containsPosition(s.graveyardPosition);if(!t.bWasUndone&&r){const o=s.splitPosition._getTransformedByMoveOperation(n),a=s.graveyardPosition._getTransformedByMoveOperation(n),f=a.path.slice();f.push(0);const h=new g(a.root,f);return[new P(o,s.howMany,h,0)]}s.graveyardPosition=s.graveyardPosition._getTransformedByMoveOperation(n)}const i=s.splitPosition.isEqual(n.targetPosition);if(i&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return s.howMany+=n.howMany,s.splitPosition=s.splitPosition._getTransformedByDeletion(n.sourcePosition,n.howMany),s.insertionPosition=v.getInsertionPosition(s.splitPosition),[s];if(i&&t.abRelation&&t.abRelation.howMany){const{howMany:r,offset:o}=t.abRelation;return s.howMany+=r,s.splitPosition=s.splitPosition.getShiftedBy(o),[s]}if(s.splitPosition.hasSameParentAs(n.sourcePosition)&&e.containsPosition(s.splitPosition)){const r=n.howMany-(s.splitPosition.offset-n.sourcePosition.offset);return s.howMany-=r,s.splitPosition.hasSameParentAs(n.targetPosition)&&s.splitPosition.offset<n.targetPosition.offset&&(s.howMany+=n.howMany),s.splitPosition=n.sourcePosition.clone(),s.insertionPosition=v.getInsertionPosition(s.splitPosition),[s]}return n.sourcePosition.isEqual(n.targetPosition)||(s.splitPosition.hasSameParentAs(n.sourcePosition)&&s.splitPosition.offset<=n.sourcePosition.offset&&(s.howMany-=n.howMany),s.splitPosition.hasSameParentAs(n.targetPosition)&&s.splitPosition.offset<n.targetPosition.offset&&(s.howMany+=n.howMany)),s.splitPosition.stickiness="toNone",s.splitPosition=s.splitPosition._getTransformedByMoveOperation(n),s.splitPosition.stickiness="toNext",s.graveyardPosition?s.insertionPosition=s.insertionPosition._getTransformedByMoveOperation(n):s.insertionPosition=v.getInsertionPosition(s.splitPosition),[s]});_(v,v,(s,n,t)=>{if(s.splitPosition.isEqual(n.splitPosition)){if(!s.graveyardPosition&&!n.graveyardPosition)return[new x(0)];if(s.graveyardPosition&&n.graveyardPosition&&s.graveyardPosition.isEqual(n.graveyardPosition))return[new x(0)];if(t.abRelation=="splitBefore")return s.howMany=0,s.graveyardPosition=s.graveyardPosition._getTransformedBySplitOperation(n),[s]}if(s.graveyardPosition&&n.graveyardPosition&&s.graveyardPosition.isEqual(n.graveyardPosition)){const e=s.splitPosition.root.rootName=="$graveyard",i=n.splitPosition.root.rootName=="$graveyard";if(i&&!e||!(e&&!i)&&t.aIsStrong){const f=[];return n.howMany&&f.push(new P(n.moveTargetPosition,n.howMany,n.splitPosition,0)),s.howMany&&f.push(new P(s.splitPosition,s.howMany,s.moveTargetPosition,0)),f}else return[new x(0)]}if(s.graveyardPosition&&(s.graveyardPosition=s.graveyardPosition._getTransformedBySplitOperation(n)),s.splitPosition.isEqual(n.insertionPosition)&&t.abRelation=="splitBefore")return s.howMany++,[s];if(n.splitPosition.isEqual(s.insertionPosition)&&t.baRelation=="splitBefore"){const e=n.insertionPosition.path.slice();e.push(0);const i=new g(n.insertionPosition.root,e),r=new P(s.insertionPosition,1,i,0);return[s,r]}return s.splitPosition.hasSameParentAs(n.splitPosition)&&s.splitPosition.offset<n.splitPosition.offset&&(s.howMany-=n.howMany),s.splitPosition=s.splitPosition._getTransformedBySplitOperation(n),s.insertionPosition=v.getInsertionPosition(s.splitPosition),[s]});function be(s,n){return s.targetPosition._getTransformedByDeletion(n.sourcePosition,n.howMany)===null}function st(s,n){const t=[];for(let e=0;e<s.length;e++){const i=s[e],r=new P(i.start,i.end.offset-i.start.offset,n,0);t.push(r);for(let o=e+1;o<s.length;o++)s[o]=s[o]._getTransformedByMove(r.sourcePosition,r.targetPosition,r.howMany)[0];n=n._getTransformedByMove(r.sourcePosition,r.targetPosition,r.howMany)}return t}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Vn extends E(g){constructor(n,t,e="toNone"){if(super(n,t,e),!this.root.is("rootElement"))throw new u("model-liveposition-root-not-rootelement",n);Dn.call(this)}detach(){this.stopListening()}toPosition(){return new g(this.root,this.path.slice(),this.stickiness)}static fromPosition(n,t){return new this(n.root,n.path.slice(),t||n.stickiness)}}Vn.prototype.is=function(s){return s==="livePosition"||s==="model:livePosition"||s=="position"||s==="model:position"};function Dn(){this.listenTo(this.root.document.model,"applyOperation",(s,n)=>{const t=n[0];t.isDocumentOperation&&qn.call(this,t)},{priority:"low"})}function qn(s){const n=this.getTransformedByOperation(s);if(!this.isEqual(n)){const t=this.toPosition();this.path=n.path,this.root=n.root,this.fire("change",t)}}/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class Jn extends D{constructor(t,e,i="main"){super(e);l(this,"rootName");l(this,"_document");l(this,"_isAttached",!0);l(this,"_isLoaded",!0);this._document=t,this.rootName=i}get document(){return this._document}isAttached(){return this._isAttached}toJSON(){return this.rootName}}Jn.prototype.is=function(s,n){return n?n===this.name&&(s==="rootElement"||s==="model:rootElement"||s==="element"||s==="model:element"):s==="rootElement"||s==="model:rootElement"||s==="element"||s==="model:element"||s==="node"||s==="model:node"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class $n extends E(z){constructor(t,e,i,r){super();l(this,"name");l(this,"_managedUsingOperations");l(this,"_affectsData");l(this,"_liveRange");this.name=t,this._liveRange=this._attachLiveRange(e),this._managedUsingOperations=i,this._affectsData=r}get managedUsingOperations(){if(!this._liveRange)throw new u("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new u("marker-destroyed",this);return this._affectsData}getData(){return{range:this.getRange(),affectsData:this.affectsData,managedUsingOperations:this.managedUsingOperations}}getStart(){if(!this._liveRange)throw new u("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new u("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new u("marker-destroyed",this);return this._liveRange.toRange()}_attachLiveRange(t){return this._liveRange&&this._detachLiveRange(),t.delegate("change:range").to(this),t.delegate("change:content").to(this),this._liveRange=t,t}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}$n.prototype.is=function(s){return s==="marker"||s==="model:marker"};/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */class te extends z{constructor(t){super();l(this,"markers",new Map);l(this,"_children",new pt);t&&this._insertChild(0,t)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get nextSibling(){return null}get previousSibling(){return null}get root(){return this}get parent(){return null}get document(){return null}isAttached(){return!1}getAncestors(){return[]}getChild(t){return this._children.getNode(t)}getChildAtOffset(t){return this._children.getNodeAtOffset(t)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(t){return this._children.getNodeIndex(t)}getChildStartOffset(t){return this._children.getNodeStartOffset(t)}getPath(){return[]}getNodeByPath(t){let e=this;for(const i of t)e=e.getChildAtOffset(i);return e}offsetToIndex(t){return this._children.offsetToIndex(t)}toJSON(){const t=[];for(const e of this._children)t.push(e.toJSON());return t}static fromJSON(t){const e=[];for(const i of t)i.name?e.push(D.fromJSON(i)):e.push(b.fromJSON(i));return new te(e)}_appendChild(t){this._insertChild(this.childCount,t)}_insertChild(t,e){const i=Wn(e);for(const r of i)r.parent!==null&&r._remove(),r.parent=this;this._children._insertNodes(t,i)}_removeChildren(t,e=1){const i=this._children._removeNodes(t,e);for(const r of i)r.parent=null;return i}_removeChildrenArray(t){this._children._removeNodesArray(t);for(const e of t)e.parent=null}}te.prototype.is=function(s){return s==="documentFragment"||s==="model:documentFragment"};function Wn(s){return typeof s=="string"?[new b(s)]:(q(s)||(s=[s]),Array.from(s).map(n=>typeof n=="string"?new b(n):n instanceof Y?new b(n.data,n.getAttributes()):n))}const zn="data:image/svg+xml,%3csvg%20viewBox='0%200%2010%208'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9.055.263v3.972h-6.77M1%204.216l2-2.038m-2%202%202%202.038'/%3e%3c/svg%3e";/**
 * @license Copyright (c) 2003-2025, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-licensing-options
 */new DOMParser().parseFromString(zn,"image/svg+xml").firstChild;window.KashidaXBlockStudio=function(n,t){document.getElementById("saveBtn").addEventListener("click",()=>{const i=window.kashidaEditor.getData({rootName:"textRegion"}),r=window.kashidaEditor.getData({rootName:"imageRegion"}),o=document.querySelector(".kashida-editor").classList.contains("image-left")?"image-left":"image-right";n.notify("save",{state:"start"}),n.invoke("save_kashida_block",{text_content:i,image_content:r,layout:o}).then(()=>{n.notify("save",{state:"end"})})})};
